<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>The random forest on loan’s report</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  { background-color: #f8f8f8; }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">FGV MBA</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
    Home
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-hand-holding-usd"></span>
     
    Business Case
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="01_about_the_data.html">About the Data</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Initial Analysis</li>
    <li>
      <a href="02_data_preparation.html">Data Preparation</a>
    </li>
    <li>
      <a href="03_exploration_report.html">Data Exploration</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-file-invoice"></span>
     
    Model's Reports
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Analytical Methods</li>
    <li>
      <a href="04_logistic_regression_report.html">Logistic Regression Report</a>
    </li>
    <li>
      <a href="05_decision_tree_report.html">Decision Tree Report</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Ensembe Methods</li>
    <li>
      <a href="06_boosting_report.html">Boosting Report</a>
    </li>
    <li>
      <a href="07_random_forest_report.html">Random Forest Report</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-file-invoice-dollar"></span>
     
    Final Report
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="08_conclusion.html">Conclusion</a>
    </li>
    <li>
      <a href="09_references.html">References</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">The random forest on loan’s report</h1>
<h4 class="date">August, 2019</h4>

</div>

<div id="TOC">
<ul>
<li><a href="#objective"><span class="toc-section-number">1</span> Objective</a></li>
<li><a href="#modeling"><span class="toc-section-number">2</span> Modeling</a><ul>
<li><a href="#dataset-preparation"><span class="toc-section-number">2.1</span> Dataset preparation</a></li>
<li><a href="#variable-selection"><span class="toc-section-number">2.2</span> Variable selection</a></li>
<li><a href="#sample-split-into-test-and-training-data"><span class="toc-section-number">2.3</span> Sample split into Test and Training Data</a></li>
</ul></li>
<li><a href="#selecting-the-best-parameters-values-for-the-random-forest"><span class="toc-section-number">3</span> Selecting the best parameters values for the Random Forest</a></li>
<li><a href="#interpreting-model-output"><span class="toc-section-number">4</span> Interpreting model output</a></li>
<li><a href="#evaluating-the-model-performance"><span class="toc-section-number">5</span> Evaluating the model performance</a><ul>
<li><a href="#getting-performance-measures"><span class="toc-section-number">5.1</span> Getting Performance Measures</a></li>
<li><a href="#evaluating-classification-performance"><span class="toc-section-number">5.2</span> Evaluating classification performance</a></li>
</ul></li>
</ul>
</div>

<div id="objective" class="section level1">
<h1><span class="header-section-number">1</span> Objective</h1>
<p>The goal of this session is trying to fit a Random Forest model on Loan data aiming to predict the probability of delinquency for each contract.</p>
<p>Random forest, in essence, consists of a large set of individual decision trees operating as an ensemble. Therefore, each individual tree in the random forest spits out a class prediction and the class with the most votes becomes our model’s prediction.</p>
<blockquote>
The fundamental concept behind random forest is a simple but powerful one — the wisdom of crowds. In data science speak, the reason that the random forest model works so well is: A large number of relatively uncorrelated models (trees) operating as a committee will outperform any of the individual constituent models.
<footer>
— Tony Yiu
</footer>
</blockquote>
<hr />
</div>
<div id="modeling" class="section level1">
<h1><span class="header-section-number">2</span> Modeling</h1>
<div id="dataset-preparation" class="section level2">
<h2><span class="header-section-number">2.1</span> Dataset preparation</h2>
<p>Using the vanilla transaction dataset, we calculated several derived variables for each account as described in the Data Preparation session.</p>
<p>This dataset is joined with Loan, Client, Credit Card, District, Account and Account Balance tables.</p>
<p>We ended up having a data set with <strong>118 variables</strong>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1">loan_dataset_rf &lt;-<span class="st"> </span>source_dataset</a>
<a class="sourceLine" id="cb1-2" title="2"></a>
<a class="sourceLine" id="cb1-3" title="3"><span class="kw">kable</span>(<span class="kw">tibble</span>(<span class="dt">variables =</span> <span class="kw">names</span>(loan_dataset_rf)))</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">variables</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">y_loan_defaulter</td>
</tr>
<tr class="even">
<td align="left">x_account_balance</td>
</tr>
<tr class="odd">
<td align="left">x_average_salary</td>
</tr>
<tr class="even">
<td align="left">x_avg_account_balance</td>
</tr>
<tr class="odd">
<td align="left">x_card_age_month</td>
</tr>
<tr class="even">
<td align="left">x_card_type_classic</td>
</tr>
<tr class="odd">
<td align="left">x_card_type_gold</td>
</tr>
<tr class="even">
<td align="left">x_card_type_junior</td>
</tr>
<tr class="odd">
<td align="left">x_client_age</td>
</tr>
<tr class="even">
<td align="left">x_client_gender_male</td>
</tr>
<tr class="odd">
<td align="left">x_district_name_Benesov</td>
</tr>
<tr class="even">
<td align="left">x_district_name_Beroun</td>
</tr>
<tr class="odd">
<td align="left">x_district_name_Blansko</td>
</tr>
<tr class="even">
<td align="left">x_district_name_Breclav</td>
</tr>
<tr class="odd">
<td align="left">x_district_name_Brno_mesto</td>
</tr>
<tr class="even">
<td align="left">x_district_name_Brno_venkov</td>
</tr>
<tr class="odd">
<td align="left">x_district_name_Bruntal</td>
</tr>
<tr class="even">
<td align="left">x_district_name_Ceska_Lipa</td>
</tr>
<tr class="odd">
<td align="left">x_district_name_Ceske_Budejovice</td>
</tr>
<tr class="even">
<td align="left">x_district_name_Cesky_Krumlov</td>
</tr>
<tr class="odd">
<td align="left">x_district_name_Cheb</td>
</tr>
<tr class="even">
<td align="left">x_district_name_Chomutov</td>
</tr>
<tr class="odd">
<td align="left">x_district_name_Chrudim</td>
</tr>
<tr class="even">
<td align="left">x_district_name_Decin</td>
</tr>
<tr class="odd">
<td align="left">x_district_name_Domazlice</td>
</tr>
<tr class="even">
<td align="left">x_district_name_Frydek_Mistek</td>
</tr>
<tr class="odd">
<td align="left">x_district_name_Havlickuv_Brod</td>
</tr>
<tr class="even">
<td align="left">x_district_name_Hl.m._Praha</td>
</tr>
<tr class="odd">
<td align="left">x_district_name_Hodonin</td>
</tr>
<tr class="even">
<td align="left">x_district_name_Hradec_Kralove</td>
</tr>
<tr class="odd">
<td align="left">x_district_name_Jablonec_n._Nisou</td>
</tr>
<tr class="even">
<td align="left">x_district_name_Jesenik</td>
</tr>
<tr class="odd">
<td align="left">x_district_name_Jicin</td>
</tr>
<tr class="even">
<td align="left">x_district_name_Jihlava</td>
</tr>
<tr class="odd">
<td align="left">x_district_name_Jindrichuv_Hradec</td>
</tr>
<tr class="even">
<td align="left">x_district_name_Karlovy_Vary</td>
</tr>
<tr class="odd">
<td align="left">x_district_name_Karvina</td>
</tr>
<tr class="even">
<td align="left">x_district_name_Kladno</td>
</tr>
<tr class="odd">
<td align="left">x_district_name_Klatovy</td>
</tr>
<tr class="even">
<td align="left">x_district_name_Kolin</td>
</tr>
<tr class="odd">
<td align="left">x_district_name_Kromeriz</td>
</tr>
<tr class="even">
<td align="left">x_district_name_Kutna_Hora</td>
</tr>
<tr class="odd">
<td align="left">x_district_name_Liberec</td>
</tr>
<tr class="even">
<td align="left">x_district_name_Litomerice</td>
</tr>
<tr class="odd">
<td align="left">x_district_name_Louny</td>
</tr>
<tr class="even">
<td align="left">x_district_name_Melnik</td>
</tr>
<tr class="odd">
<td align="left">x_district_name_Mlada_Boleslav</td>
</tr>
<tr class="even">
<td align="left">x_district_name_Most</td>
</tr>
<tr class="odd">
<td align="left">x_district_name_Nachod</td>
</tr>
<tr class="even">
<td align="left">x_district_name_Novy_Jicin</td>
</tr>
<tr class="odd">
<td align="left">x_district_name_Nymburk</td>
</tr>
<tr class="even">
<td align="left">x_district_name_Olomouc</td>
</tr>
<tr class="odd">
<td align="left">x_district_name_Opava</td>
</tr>
<tr class="even">
<td align="left">x_district_name_Ostrava_mesto</td>
</tr>
<tr class="odd">
<td align="left">x_district_name_Pardubice</td>
</tr>
<tr class="even">
<td align="left">x_district_name_Pelhrimov</td>
</tr>
<tr class="odd">
<td align="left">x_district_name_Pisek</td>
</tr>
<tr class="even">
<td align="left">x_district_name_Plzen_jih</td>
</tr>
<tr class="odd">
<td align="left">x_district_name_Plzen_mesto</td>
</tr>
<tr class="even">
<td align="left">x_district_name_Plzen_sever</td>
</tr>
<tr class="odd">
<td align="left">x_district_name_Prachatice</td>
</tr>
<tr class="even">
<td align="left">x_district_name_Praha_vychod</td>
</tr>
<tr class="odd">
<td align="left">x_district_name_Praha_zapad</td>
</tr>
<tr class="even">
<td align="left">x_district_name_Prerov</td>
</tr>
<tr class="odd">
<td align="left">x_district_name_Pribram</td>
</tr>
<tr class="even">
<td align="left">x_district_name_Prostejov</td>
</tr>
<tr class="odd">
<td align="left">x_district_name_Rakovnik</td>
</tr>
<tr class="even">
<td align="left">x_district_name_Rokycany</td>
</tr>
<tr class="odd">
<td align="left">x_district_name_Rychnov_nad_Kneznou</td>
</tr>
<tr class="even">
<td align="left">x_district_name_Semily</td>
</tr>
<tr class="odd">
<td align="left">x_district_name_Strakonice</td>
</tr>
<tr class="even">
<td align="left">x_district_name_Sumperk</td>
</tr>
<tr class="odd">
<td align="left">x_district_name_Svitavy</td>
</tr>
<tr class="even">
<td align="left">x_district_name_Tabor</td>
</tr>
<tr class="odd">
<td align="left">x_district_name_Tachov</td>
</tr>
<tr class="even">
<td align="left">x_district_name_Teplice</td>
</tr>
<tr class="odd">
<td align="left">x_district_name_Trebic</td>
</tr>
<tr class="even">
<td align="left">x_district_name_Trutnov</td>
</tr>
<tr class="odd">
<td align="left">x_district_name_Uherske_Hradiste</td>
</tr>
<tr class="even">
<td align="left">x_district_name_Usti_nad_Labem</td>
</tr>
<tr class="odd">
<td align="left">x_district_name_Usti_nad_Orlici</td>
</tr>
<tr class="even">
<td align="left">x_district_name_Vsetin</td>
</tr>
<tr class="odd">
<td align="left">x_district_name_Vyskov</td>
</tr>
<tr class="even">
<td align="left">x_district_name_Zdar_nad_Sazavou</td>
</tr>
<tr class="odd">
<td align="left">x_district_name_Zlin</td>
</tr>
<tr class="even">
<td align="left">x_district_name_Znojmo</td>
</tr>
<tr class="odd">
<td align="left">x_last_transaction_age_days</td>
</tr>
<tr class="even">
<td align="left">x_loan_amount</td>
</tr>
<tr class="odd">
<td align="left">x_loan_duration</td>
</tr>
<tr class="even">
<td align="left">x_loan_payments</td>
</tr>
<tr class="odd">
<td align="left">x_no_of_cities</td>
</tr>
<tr class="even">
<td align="left">x_no_of_commited_crimes_1995</td>
</tr>
<tr class="odd">
<td align="left">x_no_of_commited_crimes_1996</td>
</tr>
<tr class="even">
<td align="left">x_no_of_enterpreneurs_per_1000_inhabitants</td>
</tr>
<tr class="odd">
<td align="left">x_no_of_inhabitants</td>
</tr>
<tr class="even">
<td align="left">x_no_of_municip_2000_to_9999</td>
</tr>
<tr class="odd">
<td align="left">x_no_of_municip_500_to_1999</td>
</tr>
<tr class="even">
<td align="left">x_no_of_municip_greater_10000</td>
</tr>
<tr class="odd">
<td align="left">x_no_of_municip_inhabitants_less_499</td>
</tr>
<tr class="even">
<td align="left">x_prop_household</td>
</tr>
<tr class="odd">
<td align="left">x_prop_insurance_payment</td>
</tr>
<tr class="even">
<td align="left">x_prop_interest_credited</td>
</tr>
<tr class="odd">
<td align="left">x_prop_loan_payment</td>
</tr>
<tr class="even">
<td align="left">x_prop_old_age_pension</td>
</tr>
<tr class="odd">
<td align="left">x_prop_other</td>
</tr>
<tr class="even">
<td align="left">x_prop_statement</td>
</tr>
<tr class="odd">
<td align="left">x_ratio_of_urban_inhabitants</td>
</tr>
<tr class="even">
<td align="left">x_region_central_Bohemia</td>
</tr>
<tr class="odd">
<td align="left">x_region_east_Bohemia</td>
</tr>
<tr class="even">
<td align="left">x_region_north_Bohemia</td>
</tr>
<tr class="odd">
<td align="left">x_region_north_Moravia</td>
</tr>
<tr class="even">
<td align="left">x_region_Prague</td>
</tr>
<tr class="odd">
<td align="left">x_region_south_Bohemia</td>
</tr>
<tr class="even">
<td align="left">x_region_south_Moravia</td>
</tr>
<tr class="odd">
<td align="left">x_transaction_amount</td>
</tr>
<tr class="even">
<td align="left">x_transaction_count</td>
</tr>
<tr class="odd">
<td align="left">x_unemploymant_rate_1995</td>
</tr>
<tr class="even">
<td align="left">x_unemploymant_rate_1996</td>
</tr>
</tbody>
</table>
</div>
<div id="variable-selection" class="section level2">
<h2><span class="header-section-number">2.2</span> Variable selection</h2>
<p>One advantage of Boosting models is that it does not require heavy feature engineering.</p>
<p>We will only remove <strong>x_prop_old_age_pension</strong> that we know beforehand to have no variance in the dataset.</p>
<p>This model is also not sensible to outliers, missing values and multicollinearity.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1">loan_dataset_rf &lt;-<span class="st"> </span>dplyr<span class="op">::</span><span class="kw">select</span>(loan_dataset_rf, <span class="op">-</span>x_prop_old_age_pension)</a></code></pre></div>
</div>
<div id="sample-split-into-test-and-training-data" class="section level2">
<h2><span class="header-section-number">2.3</span> Sample split into Test and Training Data</h2>
<p>The available data in Loan Dataset is split into Train and Testing data on the following proportion:</p>
<ul>
<li><strong>Train Dataset</strong> (70% 478 obs);</li>
<li><strong>Test Dataset </strong> (30% 204 obs).</li>
</ul>
<p>We are selecting exact the same samples for all models to allow comparison between then.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1">SplitDataset &lt;-<span class="st"> </span>source_train_test_dataset</a>
<a class="sourceLine" id="cb3-2" title="2">data.train_rf &lt;-<span class="st"> </span>SplitDataset<span class="op">$</span>data.train</a>
<a class="sourceLine" id="cb3-3" title="3">data.test_rf &lt;-<span class="st"> </span>SplitDataset<span class="op">$</span>data.test</a>
<a class="sourceLine" id="cb3-4" title="4"></a>
<a class="sourceLine" id="cb3-5" title="5"><span class="kw">kable</span>(SplitDataset<span class="op">$</span>event.proportion)</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">scope</th>
<th align="right">0</th>
<th align="right">1</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">full dataset</td>
<td align="right">0.8885630</td>
<td align="right">0.1114370</td>
</tr>
<tr class="even">
<td align="left">train dataset</td>
<td align="right">0.8933054</td>
<td align="right">0.1066946</td>
</tr>
<tr class="odd">
<td align="left">test dataset</td>
<td align="right">0.8774510</td>
<td align="right">0.1225490</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1">loan_dataset_rf<span class="op">$</span>y_loan_defaulter &lt;-<span class="st"> </span><span class="kw">as.factor</span>(loan_dataset_rf<span class="op">$</span>y_loan_defaulter)</a>
<a class="sourceLine" id="cb4-2" title="2">data.train_rf<span class="op">$</span>y_loan_defaulter   &lt;-<span class="st"> </span><span class="kw">as.factor</span>(data.train_rf<span class="op">$</span>y_loan_defaulter)</a>
<a class="sourceLine" id="cb4-3" title="3">data.test_rf<span class="op">$</span>y_loan_defaulter    &lt;-<span class="st"> </span><span class="kw">as.factor</span>(data.test_rf<span class="op">$</span>y_loan_defaulter)</a>
<a class="sourceLine" id="cb4-4" title="4"></a>
<a class="sourceLine" id="cb4-5" title="5">data.train_rf &lt;-<span class="st"> </span>dplyr<span class="op">::</span><span class="kw">select</span>(data.train_rf, <span class="kw">names</span>(loan_dataset_rf))</a>
<a class="sourceLine" id="cb4-6" title="6">data.test_rf &lt;-<span class="st"> </span>dplyr<span class="op">::</span><span class="kw">select</span>(data.test_rf, <span class="kw">names</span>(loan_dataset_rf))</a></code></pre></div>
<p>Both datasets keep the same proportion for the explained variable around 11%.</p>
<hr />
</div>
</div>
<div id="selecting-the-best-parameters-values-for-the-random-forest" class="section level1">
<h1><span class="header-section-number">3</span> Selecting the best parameters values for the Random Forest</h1>
<p>The R community is a one of R’s best features. There are many community members doing awesome improvements on the existent libraries.</p>
<p>Todo: incluir explicação do código abaixo, referência para o autor no markdown de Referências e repetir o nome do cara aqui.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1">customRF &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">type =</span> <span class="st">&quot;Classification&quot;</span>, <span class="dt">library =</span> <span class="st">&quot;randomForest&quot;</span>, <span class="dt">loop =</span> <span class="ot">NULL</span>)</a>
<a class="sourceLine" id="cb5-2" title="2"></a>
<a class="sourceLine" id="cb5-3" title="3">customRF<span class="op">$</span>parameters &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">parameter =</span> <span class="kw">c</span>(<span class="st">&quot;mtry&quot;</span>, <span class="st">&quot;ntree&quot;</span>), </a>
<a class="sourceLine" id="cb5-4" title="4">                                  <span class="dt">class =</span> <span class="kw">rep</span>(<span class="st">&quot;numeric&quot;</span>, <span class="dv">2</span>), </a>
<a class="sourceLine" id="cb5-5" title="5">                                  <span class="dt">label =</span> <span class="kw">c</span>(<span class="st">&quot;mtry&quot;</span>, <span class="st">&quot;ntree&quot;</span>))</a>
<a class="sourceLine" id="cb5-6" title="6"></a>
<a class="sourceLine" id="cb5-7" title="7">customRF<span class="op">$</span>grid &lt;-<span class="st"> </span><span class="cf">function</span>(x, y, <span class="dt">len =</span> <span class="ot">NULL</span>, <span class="dt">search =</span> <span class="st">&quot;grid&quot;</span>) {}</a>
<a class="sourceLine" id="cb5-8" title="8"></a>
<a class="sourceLine" id="cb5-9" title="9">customRF<span class="op">$</span>fit &lt;-<span class="st"> </span><span class="cf">function</span>(x, y, wts, param, lev, last, weights, classProbs, ...) {</a>
<a class="sourceLine" id="cb5-10" title="10">  <span class="kw">randomForest</span>(x, y, <span class="dt">mtry =</span> param<span class="op">$</span>mtry, <span class="dt">ntree=</span>param<span class="op">$</span>ntree, ...)</a>
<a class="sourceLine" id="cb5-11" title="11">}</a>
<a class="sourceLine" id="cb5-12" title="12"></a>
<a class="sourceLine" id="cb5-13" title="13">customRF<span class="op">$</span>predict &lt;-<span class="st"> </span><span class="cf">function</span>(modelFit, newdata, <span class="dt">preProc =</span> <span class="ot">NULL</span>, <span class="dt">submodels =</span> <span class="ot">NULL</span>)</a>
<a class="sourceLine" id="cb5-14" title="14">  <span class="kw">predict</span>(modelFit, newdata)</a>
<a class="sourceLine" id="cb5-15" title="15"></a>
<a class="sourceLine" id="cb5-16" title="16">customRF<span class="op">$</span>prob &lt;-<span class="st"> </span><span class="cf">function</span>(modelFit, newdata, <span class="dt">preProc =</span> <span class="ot">NULL</span>, <span class="dt">submodels =</span> <span class="ot">NULL</span>)</a>
<a class="sourceLine" id="cb5-17" title="17">  <span class="kw">predict</span>(modelFit, newdata, <span class="dt">type =</span> <span class="st">&quot;prob&quot;</span>)</a>
<a class="sourceLine" id="cb5-18" title="18"></a>
<a class="sourceLine" id="cb5-19" title="19">customRF<span class="op">$</span>sort &lt;-<span class="st"> </span><span class="cf">function</span>(x) x[<span class="kw">order</span>(x[,<span class="dv">1</span>]),]</a>
<a class="sourceLine" id="cb5-20" title="20"></a>
<a class="sourceLine" id="cb5-21" title="21">customRF<span class="op">$</span>levels &lt;-<span class="st"> </span><span class="cf">function</span>(x) x<span class="op">$</span>classes</a></code></pre></div>
<p>The following code is able to fit the random forest model using the caret customized train function above. Then, we just have to give some parameters values to be tested and after running this pretty code we can benefits from its results by having which parameters performed best.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1">control &lt;-<span class="st"> </span><span class="kw">trainControl</span>(<span class="dt">method=</span><span class="st">&quot;repeatedcv&quot;</span>, </a>
<a class="sourceLine" id="cb6-2" title="2">                        <span class="dt">number=</span><span class="dv">5</span>, </a>
<a class="sourceLine" id="cb6-3" title="3">                        <span class="dt">repeats=</span><span class="dv">3</span>, </a>
<a class="sourceLine" id="cb6-4" title="4">                        <span class="dt">verboseIter =</span> <span class="ot">TRUE</span>, </a>
<a class="sourceLine" id="cb6-5" title="5">                        <span class="dt">allowParallel =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb6-6" title="6"></a>
<a class="sourceLine" id="cb6-7" title="7">tuneparam &lt;-<span class="st"> </span><span class="kw">expand.grid</span>(<span class="dt">.mtry=</span><span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">25</span>, <span class="dv">50</span>, <span class="dv">75</span>, <span class="dv">85</span>, <span class="dv">100</span>, <span class="dv">115</span>, <span class="dv">125</span>, <span class="dv">150</span>, <span class="dv">175</span>, <span class="dv">200</span>),</a>
<a class="sourceLine" id="cb6-8" title="8">                         <span class="dt">.ntree=</span><span class="kw">c</span>(<span class="dv">1000</span>, <span class="dv">3000</span>, <span class="dv">5000</span>, <span class="dv">7000</span>, <span class="dv">9000</span>, <span class="dv">10000</span>))</a>
<a class="sourceLine" id="cb6-9" title="9"></a>
<a class="sourceLine" id="cb6-10" title="10">evalmetric &lt;-<span class="st"> &quot;Accuracy&quot;</span></a>
<a class="sourceLine" id="cb6-11" title="11"></a>
<a class="sourceLine" id="cb6-12" title="12"><span class="kw">set.seed</span>(<span class="dv">12345</span>)</a>
<a class="sourceLine" id="cb6-13" title="13"></a>
<a class="sourceLine" id="cb6-14" title="14">ini &lt;-<span class="st"> </span><span class="kw">Sys.time</span>()</a>
<a class="sourceLine" id="cb6-15" title="15"><span class="kw">cat</span>(<span class="kw">paste0</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">Started RF training at: &quot;</span>, ini, <span class="st">&quot; ...</span><span class="ch">\n\n</span><span class="st">&quot;</span>))</a>
<a class="sourceLine" id="cb6-16" title="16"></a>
<a class="sourceLine" id="cb6-17" title="17">rf.full &lt;-<span class="st"> </span><span class="kw">train</span>(y_loan_defaulter <span class="op">~</span><span class="st"> </span>.,</a>
<a class="sourceLine" id="cb6-18" title="18">                 <span class="dt">data=</span>data.train_rf,</a>
<a class="sourceLine" id="cb6-19" title="19">                 <span class="dt">method=</span>customRF,</a>
<a class="sourceLine" id="cb6-20" title="20">                 <span class="dt">metric=</span>evalmetric,</a>
<a class="sourceLine" id="cb6-21" title="21">                 <span class="dt">tuneGrid=</span>tuneparam,</a>
<a class="sourceLine" id="cb6-22" title="22">                 <span class="dt">trControl=</span>control,</a>
<a class="sourceLine" id="cb6-23" title="23">                 <span class="dt">importance=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb6-24" title="24"></a>
<a class="sourceLine" id="cb6-25" title="25">elapsedTime &lt;-<span class="st"> </span><span class="kw">difftime</span>(<span class="kw">Sys.time</span>(), ini, <span class="dt">units =</span> <span class="st">&quot;auto&quot;</span>)</a>
<a class="sourceLine" id="cb6-26" title="26"><span class="kw">cat</span>(<span class="kw">paste0</span>(<span class="st">&quot;</span><span class="ch">\n\n</span><span class="st">Finished RF training. Total time taken: &quot;</span>, <span class="kw">round</span>(elapsedTime, <span class="dv">2</span>), <span class="st">&quot; &quot;</span>, <span class="kw">units</span>(elapsedTime)))</a>
<a class="sourceLine" id="cb6-27" title="27"></a>
<a class="sourceLine" id="cb6-28" title="28"><span class="kw">summary</span>(rf.full)</a>
<a class="sourceLine" id="cb6-29" title="29"><span class="kw">plot</span>(rf.full)</a></code></pre></div>
<p>After some time waiting for the results, about 5 hours, we ended up selecting the best parameters, as following:</p>
<ul>
<li><strong>mtry = 85</strong></li>
<li><strong>ntree = 3000</strong></li>
</ul>
<p>Last but not least, we saved the final model results on disk to be quickly consumed when necessary.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1"><span class="kw">saveRDS</span>(rf.full, <span class="st">&quot;./models/random_forest.rds&quot;</span>)</a></code></pre></div>
<p>So, to save time, we only have to load the fitted model saved on disk.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1">rf.full &lt;-<span class="st"> </span><span class="kw">readRDS</span>(<span class="st">&quot;./models/random_forest.rds&quot;</span>)</a></code></pre></div>
<hr />
</div>
<div id="interpreting-model-output" class="section level1">
<h1><span class="header-section-number">4</span> Interpreting model output</h1>
<p>To-do.</p>
<hr />
</div>
<div id="evaluating-the-model-performance" class="section level1">
<h1><span class="header-section-number">5</span> Evaluating the model performance</h1>
<p>To-do.</p>
<div id="getting-performance-measures" class="section level2">
<h2><span class="header-section-number">5.1</span> Getting Performance Measures</h2>
<p>To-do.</p>
</div>
<div id="evaluating-classification-performance" class="section level2">
<h2><span class="header-section-number">5.2</span> Evaluating classification performance</h2>
<p>To-do.</p>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
