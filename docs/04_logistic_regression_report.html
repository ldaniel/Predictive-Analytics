<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>The logistic regression on loan’s report</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/htmlwidgets-1.3/htmlwidgets.js"></script>
<script src="site_libs/plotly-binding-4.9.0/plotly.js"></script>
<script src="site_libs/typedarray-0.1/typedarray.min.js"></script>
<link href="site_libs/crosstalk-1.0.0/css/crosstalk.css" rel="stylesheet" />
<script src="site_libs/crosstalk-1.0.0/js/crosstalk.min.js"></script>
<link href="site_libs/plotly-htmlwidgets-css-1.46.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="site_libs/plotly-main-1.46.1/plotly-latest.min.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  { background-color: #f8f8f8; }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">FGV MBA</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
    Home
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-hand-holding-usd"></span>
     
    Business Case
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="01_about_the_data.html">About the Data</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Initial Analysis</li>
    <li>
      <a href="02_data_preparation.html">Data Preparation</a>
    </li>
    <li>
      <a href="03_exploration_report.html">Data Exploration</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-file-invoice"></span>
     
    Model's Reports
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Analytical Methods</li>
    <li>
      <a href="04_logistic_regression_report.html">Logistic Regression Report</a>
    </li>
    <li>
      <a href="05_decision_tree_report.html">Decision Tree Report</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Ensembe Methods</li>
    <li>
      <a href="06_boosting_report.html">Boosting Report</a>
    </li>
    <li>
      <a href="07_random_forest_report.html">Random Forest Report</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-file-invoice-dollar"></span>
     
    Final Report
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="08_conclusion.html">Conclusion</a>
    </li>
    <li>
      <a href="09_references.html">References</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">The logistic regression on loan’s report</h1>
<h4 class="date">August, 2019</h4>

</div>

<div id="TOC">
<ul>
<li><a href="#objective"><span class="toc-section-number">1</span> Objective</a></li>
<li><a href="#modeling"><span class="toc-section-number">2</span> Modeling</a><ul>
<li><a href="#dataset-preparation"><span class="toc-section-number">2.1</span> Dataset preparation</a></li>
<li><a href="#variable-selection"><span class="toc-section-number">2.2</span> Variable selection</a><ul>
<li><a href="#dummy-variables"><span class="toc-section-number">2.2.1</span> Dummy variables</a></li>
<li><a href="#transaction-type-proportion-variables"><span class="toc-section-number">2.2.2</span> Transaction type proportion variables</a></li>
<li><a href="#multicollinearity-on-feature-variables"><span class="toc-section-number">2.2.3</span> Multicollinearity on feature variables</a></li>
</ul></li>
<li><a href="#looking-for-outliers"><span class="toc-section-number">2.3</span> Looking for outliers</a></li>
<li><a href="#sample-split-into-test-and-training-data"><span class="toc-section-number">2.4</span> Sample split into Test and Training Data</a></li>
<li><a href="#fit-the-logistic-model"><span class="toc-section-number">2.5</span> Fit the logistic model</a></li>
</ul></li>
<li><a href="#interpreting-model-output"><span class="toc-section-number">3</span> Interpreting model output</a></li>
<li><a href="#evaluating-the-model-performance"><span class="toc-section-number">4</span> Evaluating the model performance</a><ul>
<li><a href="#getting-performance-measures"><span class="toc-section-number">4.1</span> Getting Performance Measures</a></li>
<li><a href="#evaluating-classification-performance"><span class="toc-section-number">4.2</span> Evaluating classification performance</a></li>
</ul></li>
</ul>
</div>

<div id="objective" class="section level1">
<h1><span class="header-section-number">1</span> Objective</h1>
<p>The goal of this session is trying to fit a Logistic Regression model on Loan data aiming to predict the probability of delinquency for each contract.</p>
<hr />
</div>
<div id="modeling" class="section level1">
<h1><span class="header-section-number">2</span> Modeling</h1>
<div id="dataset-preparation" class="section level2">
<h2><span class="header-section-number">2.1</span> Dataset preparation</h2>
<p>Using the vanilla transaction dataset, we calculated several derived variables for each account as described in the Data Preparation session.</p>
<p>This dataset is joined with Loan, Client, Credit Card, District, Account and Account Balance tables.</p>
<p>We ended up having a data set with <strong>118 variables</strong>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1">loan_dataset_logistic &lt;-<span class="st"> </span>source_dataset</a>
<a class="sourceLine" id="cb1-2" title="2"></a>
<a class="sourceLine" id="cb1-3" title="3"><span class="kw">kable</span>(<span class="kw">tibble</span>(<span class="dt">variables =</span> <span class="kw">names</span>(loan_dataset_logistic)))</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">variables</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">y_loan_defaulter</td>
</tr>
<tr class="even">
<td align="left">x_account_balance</td>
</tr>
<tr class="odd">
<td align="left">x_average_salary</td>
</tr>
<tr class="even">
<td align="left">x_avg_account_balance</td>
</tr>
<tr class="odd">
<td align="left">x_card_age_month</td>
</tr>
<tr class="even">
<td align="left">x_card_type_classic</td>
</tr>
<tr class="odd">
<td align="left">x_card_type_gold</td>
</tr>
<tr class="even">
<td align="left">x_card_type_junior</td>
</tr>
<tr class="odd">
<td align="left">x_client_age</td>
</tr>
<tr class="even">
<td align="left">x_client_gender_male</td>
</tr>
<tr class="odd">
<td align="left">x_district_name_Benesov</td>
</tr>
<tr class="even">
<td align="left">x_district_name_Beroun</td>
</tr>
<tr class="odd">
<td align="left">x_district_name_Blansko</td>
</tr>
<tr class="even">
<td align="left">x_district_name_Breclav</td>
</tr>
<tr class="odd">
<td align="left">x_district_name_Brno_mesto</td>
</tr>
<tr class="even">
<td align="left">x_district_name_Brno_venkov</td>
</tr>
<tr class="odd">
<td align="left">x_district_name_Bruntal</td>
</tr>
<tr class="even">
<td align="left">x_district_name_Ceska_Lipa</td>
</tr>
<tr class="odd">
<td align="left">x_district_name_Ceske_Budejovice</td>
</tr>
<tr class="even">
<td align="left">x_district_name_Cesky_Krumlov</td>
</tr>
<tr class="odd">
<td align="left">x_district_name_Cheb</td>
</tr>
<tr class="even">
<td align="left">x_district_name_Chomutov</td>
</tr>
<tr class="odd">
<td align="left">x_district_name_Chrudim</td>
</tr>
<tr class="even">
<td align="left">x_district_name_Decin</td>
</tr>
<tr class="odd">
<td align="left">x_district_name_Domazlice</td>
</tr>
<tr class="even">
<td align="left">x_district_name_Frydek_Mistek</td>
</tr>
<tr class="odd">
<td align="left">x_district_name_Havlickuv_Brod</td>
</tr>
<tr class="even">
<td align="left">x_district_name_Hl.m._Praha</td>
</tr>
<tr class="odd">
<td align="left">x_district_name_Hodonin</td>
</tr>
<tr class="even">
<td align="left">x_district_name_Hradec_Kralove</td>
</tr>
<tr class="odd">
<td align="left">x_district_name_Jablonec_n._Nisou</td>
</tr>
<tr class="even">
<td align="left">x_district_name_Jesenik</td>
</tr>
<tr class="odd">
<td align="left">x_district_name_Jicin</td>
</tr>
<tr class="even">
<td align="left">x_district_name_Jihlava</td>
</tr>
<tr class="odd">
<td align="left">x_district_name_Jindrichuv_Hradec</td>
</tr>
<tr class="even">
<td align="left">x_district_name_Karlovy_Vary</td>
</tr>
<tr class="odd">
<td align="left">x_district_name_Karvina</td>
</tr>
<tr class="even">
<td align="left">x_district_name_Kladno</td>
</tr>
<tr class="odd">
<td align="left">x_district_name_Klatovy</td>
</tr>
<tr class="even">
<td align="left">x_district_name_Kolin</td>
</tr>
<tr class="odd">
<td align="left">x_district_name_Kromeriz</td>
</tr>
<tr class="even">
<td align="left">x_district_name_Kutna_Hora</td>
</tr>
<tr class="odd">
<td align="left">x_district_name_Liberec</td>
</tr>
<tr class="even">
<td align="left">x_district_name_Litomerice</td>
</tr>
<tr class="odd">
<td align="left">x_district_name_Louny</td>
</tr>
<tr class="even">
<td align="left">x_district_name_Melnik</td>
</tr>
<tr class="odd">
<td align="left">x_district_name_Mlada_Boleslav</td>
</tr>
<tr class="even">
<td align="left">x_district_name_Most</td>
</tr>
<tr class="odd">
<td align="left">x_district_name_Nachod</td>
</tr>
<tr class="even">
<td align="left">x_district_name_Novy_Jicin</td>
</tr>
<tr class="odd">
<td align="left">x_district_name_Nymburk</td>
</tr>
<tr class="even">
<td align="left">x_district_name_Olomouc</td>
</tr>
<tr class="odd">
<td align="left">x_district_name_Opava</td>
</tr>
<tr class="even">
<td align="left">x_district_name_Ostrava_mesto</td>
</tr>
<tr class="odd">
<td align="left">x_district_name_Pardubice</td>
</tr>
<tr class="even">
<td align="left">x_district_name_Pelhrimov</td>
</tr>
<tr class="odd">
<td align="left">x_district_name_Pisek</td>
</tr>
<tr class="even">
<td align="left">x_district_name_Plzen_jih</td>
</tr>
<tr class="odd">
<td align="left">x_district_name_Plzen_mesto</td>
</tr>
<tr class="even">
<td align="left">x_district_name_Plzen_sever</td>
</tr>
<tr class="odd">
<td align="left">x_district_name_Prachatice</td>
</tr>
<tr class="even">
<td align="left">x_district_name_Praha_vychod</td>
</tr>
<tr class="odd">
<td align="left">x_district_name_Praha_zapad</td>
</tr>
<tr class="even">
<td align="left">x_district_name_Prerov</td>
</tr>
<tr class="odd">
<td align="left">x_district_name_Pribram</td>
</tr>
<tr class="even">
<td align="left">x_district_name_Prostejov</td>
</tr>
<tr class="odd">
<td align="left">x_district_name_Rakovnik</td>
</tr>
<tr class="even">
<td align="left">x_district_name_Rokycany</td>
</tr>
<tr class="odd">
<td align="left">x_district_name_Rychnov_nad_Kneznou</td>
</tr>
<tr class="even">
<td align="left">x_district_name_Semily</td>
</tr>
<tr class="odd">
<td align="left">x_district_name_Strakonice</td>
</tr>
<tr class="even">
<td align="left">x_district_name_Sumperk</td>
</tr>
<tr class="odd">
<td align="left">x_district_name_Svitavy</td>
</tr>
<tr class="even">
<td align="left">x_district_name_Tabor</td>
</tr>
<tr class="odd">
<td align="left">x_district_name_Tachov</td>
</tr>
<tr class="even">
<td align="left">x_district_name_Teplice</td>
</tr>
<tr class="odd">
<td align="left">x_district_name_Trebic</td>
</tr>
<tr class="even">
<td align="left">x_district_name_Trutnov</td>
</tr>
<tr class="odd">
<td align="left">x_district_name_Uherske_Hradiste</td>
</tr>
<tr class="even">
<td align="left">x_district_name_Usti_nad_Labem</td>
</tr>
<tr class="odd">
<td align="left">x_district_name_Usti_nad_Orlici</td>
</tr>
<tr class="even">
<td align="left">x_district_name_Vsetin</td>
</tr>
<tr class="odd">
<td align="left">x_district_name_Vyskov</td>
</tr>
<tr class="even">
<td align="left">x_district_name_Zdar_nad_Sazavou</td>
</tr>
<tr class="odd">
<td align="left">x_district_name_Zlin</td>
</tr>
<tr class="even">
<td align="left">x_district_name_Znojmo</td>
</tr>
<tr class="odd">
<td align="left">x_last_transaction_age_days</td>
</tr>
<tr class="even">
<td align="left">x_loan_amount</td>
</tr>
<tr class="odd">
<td align="left">x_loan_duration</td>
</tr>
<tr class="even">
<td align="left">x_loan_payments</td>
</tr>
<tr class="odd">
<td align="left">x_no_of_cities</td>
</tr>
<tr class="even">
<td align="left">x_no_of_commited_crimes_1995</td>
</tr>
<tr class="odd">
<td align="left">x_no_of_commited_crimes_1996</td>
</tr>
<tr class="even">
<td align="left">x_no_of_enterpreneurs_per_1000_inhabitants</td>
</tr>
<tr class="odd">
<td align="left">x_no_of_inhabitants</td>
</tr>
<tr class="even">
<td align="left">x_no_of_municip_2000_to_9999</td>
</tr>
<tr class="odd">
<td align="left">x_no_of_municip_500_to_1999</td>
</tr>
<tr class="even">
<td align="left">x_no_of_municip_greater_10000</td>
</tr>
<tr class="odd">
<td align="left">x_no_of_municip_inhabitants_less_499</td>
</tr>
<tr class="even">
<td align="left">x_prop_household</td>
</tr>
<tr class="odd">
<td align="left">x_prop_insurance_payment</td>
</tr>
<tr class="even">
<td align="left">x_prop_interest_credited</td>
</tr>
<tr class="odd">
<td align="left">x_prop_loan_payment</td>
</tr>
<tr class="even">
<td align="left">x_prop_old_age_pension</td>
</tr>
<tr class="odd">
<td align="left">x_prop_other</td>
</tr>
<tr class="even">
<td align="left">x_prop_statement</td>
</tr>
<tr class="odd">
<td align="left">x_ratio_of_urban_inhabitants</td>
</tr>
<tr class="even">
<td align="left">x_region_central_Bohemia</td>
</tr>
<tr class="odd">
<td align="left">x_region_east_Bohemia</td>
</tr>
<tr class="even">
<td align="left">x_region_north_Bohemia</td>
</tr>
<tr class="odd">
<td align="left">x_region_north_Moravia</td>
</tr>
<tr class="even">
<td align="left">x_region_Prague</td>
</tr>
<tr class="odd">
<td align="left">x_region_south_Bohemia</td>
</tr>
<tr class="even">
<td align="left">x_region_south_Moravia</td>
</tr>
<tr class="odd">
<td align="left">x_transaction_amount</td>
</tr>
<tr class="even">
<td align="left">x_transaction_count</td>
</tr>
<tr class="odd">
<td align="left">x_unemploymant_rate_1995</td>
</tr>
<tr class="even">
<td align="left">x_unemploymant_rate_1996</td>
</tr>
</tbody>
</table>
</div>
<div id="variable-selection" class="section level2">
<h2><span class="header-section-number">2.2</span> Variable selection</h2>
<p>Starting from this dataset we investigate the presence of redundant or variables not useful for the model such as the ones with not enough variability or with multicollinearity.</p>
<div id="dummy-variables" class="section level3">
<h3><span class="header-section-number">2.2.1</span> Dummy variables</h3>
<p>Starting with the dummy variables. We will keep only dummies that has the event in at least 5% of the observation in the dataset.</p>
<p>The below table shows the dummy variables that will be kept in the model:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1">dummy_variables &lt;-<span class="st"> </span>dplyr<span class="op">::</span><span class="kw">select</span>(loan_dataset_logistic, </a>
<a class="sourceLine" id="cb2-2" title="2">                                 <span class="kw">starts_with</span>(<span class="st">&#39;x_client_gender&#39;</span>), </a>
<a class="sourceLine" id="cb2-3" title="3">                                 <span class="kw">starts_with</span>(<span class="st">&#39;x_district_name&#39;</span>),</a>
<a class="sourceLine" id="cb2-4" title="4">                                 <span class="kw">starts_with</span>(<span class="st">&#39;x_region&#39;</span>),</a>
<a class="sourceLine" id="cb2-5" title="5">                                 <span class="kw">starts_with</span>(<span class="st">&#39;x_card_type&#39;</span>))</a>
<a class="sourceLine" id="cb2-6" title="6"></a>
<a class="sourceLine" id="cb2-7" title="7">dummy_variables_high &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">variables =</span> <span class="kw">names</span>(dummy_variables),</a>
<a class="sourceLine" id="cb2-8" title="8">       <span class="dt">zeros =</span> <span class="kw">sapply</span>(dummy_variables, </a>
<a class="sourceLine" id="cb2-9" title="9">                      <span class="cf">function</span>(x) <span class="kw">table</span>(<span class="kw">as.character</span>(x) <span class="op">==</span><span class="st"> </span><span class="dv">0</span>)[<span class="st">&quot;TRUE&quot;</span>]),</a>
<a class="sourceLine" id="cb2-10" title="10">       <span class="dt">ones =</span> <span class="kw">sapply</span>(dummy_variables, </a>
<a class="sourceLine" id="cb2-11" title="11">                     <span class="cf">function</span>(x) <span class="kw">table</span>(<span class="kw">as.character</span>(x) <span class="op">==</span><span class="st"> </span><span class="dv">1</span>)[<span class="st">&quot;TRUE&quot;</span>])) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-12" title="12"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">prop_ones =</span> <span class="kw">round</span>(ones <span class="op">/</span><span class="st"> </span>(zeros <span class="op">+</span><span class="st"> </span>ones) <span class="op">*</span><span class="st"> </span><span class="dv">100</span>, <span class="dv">2</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-13" title="13"><span class="st">  </span><span class="kw">arrange</span>(prop_ones) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-14" title="14"><span class="st">  </span><span class="kw">filter</span>(prop_ones  <span class="op">&gt;</span><span class="st"> </span><span class="dv">5</span>)</a>
<a class="sourceLine" id="cb2-15" title="15"></a>
<a class="sourceLine" id="cb2-16" title="16"><span class="kw">kable</span>(dummy_variables_high)</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">variables</th>
<th align="right">zeros</th>
<th align="right">ones</th>
<th align="right">prop_ones</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">x_region_south_Bohemia</td>
<td align="right">621</td>
<td align="right">61</td>
<td align="right">8.94</td>
</tr>
<tr class="even">
<td align="left">x_region_north_Bohemia</td>
<td align="right">620</td>
<td align="right">62</td>
<td align="right">9.09</td>
</tr>
<tr class="odd">
<td align="left">x_district_name_Hl.m._Praha</td>
<td align="right">603</td>
<td align="right">79</td>
<td align="right">11.58</td>
</tr>
<tr class="even">
<td align="left">x_region_Prague</td>
<td align="right">603</td>
<td align="right">79</td>
<td align="right">11.58</td>
</tr>
<tr class="odd">
<td align="left">x_region_central_Bohemia</td>
<td align="right">595</td>
<td align="right">87</td>
<td align="right">12.76</td>
</tr>
<tr class="even">
<td align="left">x_region_east_Bohemia</td>
<td align="right">595</td>
<td align="right">87</td>
<td align="right">12.76</td>
</tr>
<tr class="odd">
<td align="left">x_region_north_Moravia</td>
<td align="right">565</td>
<td align="right">117</td>
<td align="right">17.16</td>
</tr>
<tr class="even">
<td align="left">x_region_south_Moravia</td>
<td align="right">549</td>
<td align="right">133</td>
<td align="right">19.50</td>
</tr>
<tr class="odd">
<td align="left">x_card_type_classic</td>
<td align="right">549</td>
<td align="right">133</td>
<td align="right">19.50</td>
</tr>
<tr class="even">
<td align="left">x_client_gender_male</td>
<td align="right">348</td>
<td align="right">334</td>
<td align="right">48.97</td>
</tr>
</tbody>
</table>
<p>The remaining dummies will be excluded from the dataset as they do not have enough variability to fit a logistic model on them.</p>
</div>
<div id="transaction-type-proportion-variables" class="section level3">
<h3><span class="header-section-number">2.2.2</span> Transaction type proportion variables</h3>
<p>After we investigated the low variability in the dummies, we take care of the calculated variables on the transaction type proportion we calculated during the data enhancement process.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1">prop_variables &lt;-<span class="st"> </span>dplyr<span class="op">::</span><span class="kw">select</span>(loan_dataset_logistic, </a>
<a class="sourceLine" id="cb3-2" title="2">                                <span class="kw">starts_with</span>(<span class="st">&#39;x_prop&#39;</span>))</a>
<a class="sourceLine" id="cb3-3" title="3"></a>
<a class="sourceLine" id="cb3-4" title="4">prop_variables &lt;-<span class="st"> </span><span class="kw">summary</span>(prop_variables)</a>
<a class="sourceLine" id="cb3-5" title="5"></a>
<a class="sourceLine" id="cb3-6" title="6"><span class="kw">kable</span>(<span class="kw">t</span>(prop_variables))</a></code></pre></div>
<table>
<tbody>
<tr class="odd">
<td align="left">x_prop_household</td>
<td align="left">Min. :0.00000</td>
<td align="left">1st Qu.:0.00000</td>
<td align="left">Median :0.08994</td>
<td align="left">Mean :0.10975</td>
<td align="left">3rd Qu.:0.20138</td>
<td align="left">Max. :0.37573</td>
</tr>
<tr class="even">
<td align="left">x_prop_insurance_payment</td>
<td align="left">Min. :0.00000</td>
<td align="left">1st Qu.:0.00000</td>
<td align="left">Median :0.00000</td>
<td align="left">Mean :0.02088</td>
<td align="left">3rd Qu.:0.00000</td>
<td align="left">Max. :0.32182</td>
</tr>
<tr class="odd">
<td align="left">x_prop_interest_credited</td>
<td align="left">Min. :0.02873</td>
<td align="left">1st Qu.:0.08951</td>
<td align="left">Median :0.11634</td>
<td align="left">Mean :0.13651</td>
<td align="left">3rd Qu.:0.16048</td>
<td align="left">Max. :0.63444</td>
</tr>
<tr class="even">
<td align="left">x_prop_loan_payment</td>
<td align="left">Min. :0.0002408</td>
<td align="left">1st Qu.:0.0475180</td>
<td align="left">Median :0.0892142</td>
<td align="left">Mean :0.0986434</td>
<td align="left">3rd Qu.:0.1392529</td>
<td align="left">Max. :0.3025147</td>
</tr>
<tr class="odd">
<td align="left">x_prop_old_age_pension</td>
<td align="left">Min. :0</td>
<td align="left">1st Qu.:0</td>
<td align="left">Median :0</td>
<td align="left">Mean :0</td>
<td align="left">3rd Qu.:0</td>
<td align="left">Max. :0</td>
</tr>
<tr class="even">
<td align="left">x_prop_other</td>
<td align="left">Min. :0.1549</td>
<td align="left">1st Qu.:0.5096</td>
<td align="left">Median :0.5962</td>
<td align="left">Mean :0.5923</td>
<td align="left">3rd Qu.:0.6889</td>
<td align="left">Max. :0.8681</td>
</tr>
<tr class="odd">
<td align="left">x_prop_statement</td>
<td align="left">Min. :0.0001203</td>
<td align="left">1st Qu.:0.0229538</td>
<td align="left">Median :0.0283864</td>
<td align="left">Mean :0.0391546</td>
<td align="left">3rd Qu.:0.0361376</td>
<td align="left">Max. :0.1883587</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1">loan_dataset_logistic &lt;-<span class="st"> </span>dplyr<span class="op">::</span><span class="kw">select</span>(loan_dataset_logistic, <span class="op">-</span>x_prop_old_age_pension)</a></code></pre></div>
<p>The variable <strong>x_prop_old_age_pension</strong> is also excluded from the dataset as it has not a single observation in this sample.</p>
<p>We ended up having a data set with <strong>40 variables</strong>.</p>
<table>
<thead>
<tr class="header">
<th align="left">variables</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">y_loan_defaulter</td>
</tr>
<tr class="even">
<td align="left">x_account_balance</td>
</tr>
<tr class="odd">
<td align="left">x_average_salary</td>
</tr>
<tr class="even">
<td align="left">x_avg_account_balance</td>
</tr>
<tr class="odd">
<td align="left">x_card_age_month</td>
</tr>
<tr class="even">
<td align="left">x_card_type_classic</td>
</tr>
<tr class="odd">
<td align="left">x_client_age</td>
</tr>
<tr class="even">
<td align="left">x_client_gender_male</td>
</tr>
<tr class="odd">
<td align="left">x_district_name_Hl.m._Praha</td>
</tr>
<tr class="even">
<td align="left">x_last_transaction_age_days</td>
</tr>
<tr class="odd">
<td align="left">x_loan_amount</td>
</tr>
<tr class="even">
<td align="left">x_loan_duration</td>
</tr>
<tr class="odd">
<td align="left">x_loan_payments</td>
</tr>
<tr class="even">
<td align="left">x_no_of_cities</td>
</tr>
<tr class="odd">
<td align="left">x_no_of_commited_crimes_1995</td>
</tr>
<tr class="even">
<td align="left">x_no_of_commited_crimes_1996</td>
</tr>
<tr class="odd">
<td align="left">x_no_of_enterpreneurs_per_1000_inhabitants</td>
</tr>
<tr class="even">
<td align="left">x_no_of_inhabitants</td>
</tr>
<tr class="odd">
<td align="left">x_no_of_municip_2000_to_9999</td>
</tr>
<tr class="even">
<td align="left">x_no_of_municip_500_to_1999</td>
</tr>
<tr class="odd">
<td align="left">x_no_of_municip_greater_10000</td>
</tr>
<tr class="even">
<td align="left">x_no_of_municip_inhabitants_less_499</td>
</tr>
<tr class="odd">
<td align="left">x_prop_household</td>
</tr>
<tr class="even">
<td align="left">x_prop_insurance_payment</td>
</tr>
<tr class="odd">
<td align="left">x_prop_interest_credited</td>
</tr>
<tr class="even">
<td align="left">x_prop_loan_payment</td>
</tr>
<tr class="odd">
<td align="left">x_prop_other</td>
</tr>
<tr class="even">
<td align="left">x_prop_statement</td>
</tr>
<tr class="odd">
<td align="left">x_ratio_of_urban_inhabitants</td>
</tr>
<tr class="even">
<td align="left">x_region_central_Bohemia</td>
</tr>
<tr class="odd">
<td align="left">x_region_east_Bohemia</td>
</tr>
<tr class="even">
<td align="left">x_region_north_Bohemia</td>
</tr>
<tr class="odd">
<td align="left">x_region_north_Moravia</td>
</tr>
<tr class="even">
<td align="left">x_region_Prague</td>
</tr>
<tr class="odd">
<td align="left">x_region_south_Bohemia</td>
</tr>
<tr class="even">
<td align="left">x_region_south_Moravia</td>
</tr>
<tr class="odd">
<td align="left">x_transaction_amount</td>
</tr>
<tr class="even">
<td align="left">x_transaction_count</td>
</tr>
<tr class="odd">
<td align="left">x_unemploymant_rate_1995</td>
</tr>
<tr class="even">
<td align="left">x_unemploymant_rate_1996</td>
</tr>
</tbody>
</table>
</div>
<div id="multicollinearity-on-feature-variables" class="section level3">
<h3><span class="header-section-number">2.2.3</span> Multicollinearity on feature variables</h3>
<p>Multicollinearity is the phenomenon in which a given predictor has a strong correlation with one or more predictors, in this scenario the multiple regression coefficient estimates may vary erratically depending on the data, or the model may not even be possible to be calculate in the case of a perfect correlation on the predictors.</p>
<p>So before we try to fit a model we ran a multicollinearity test to identify additional variables to drop from the model specification.</p>
<p>The idea here is to identify the variables with high correlation among them and keep just the variables that have no strong correlation to the other predictors. We will do so by preferring to keep the variables that have lowest correlation against the others.</p>
<p>Just looking at correlation indexes among pairs of predictors is limited as it is possible that the pairwise correlations are small, and yet a linear dependence exists among three or more variables.</p>
<p>That’s why we will rely on a test called Variance Inflation Factors, VIF for short, to detect multicollinearity.</p>
<p>Multicollinearity is poison for Regression algorithms!!!</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1">vars.quant &lt;-<span class="st"> </span><span class="kw">select_if</span>(loan_dataset_logistic, is.numeric)</a>
<a class="sourceLine" id="cb5-2" title="2">VIF &lt;-<span class="st"> </span><span class="kw">imcdiag</span>(vars.quant, loan_dataset_logistic<span class="op">$</span>y_loan_defaulter)</a>
<a class="sourceLine" id="cb5-3" title="3"></a>
<a class="sourceLine" id="cb5-4" title="4">VIF_Table_Before &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">variable =</span> <span class="kw">names</span>(VIF<span class="op">$</span>idiags[,<span class="dv">1</span>]),</a>
<a class="sourceLine" id="cb5-5" title="5">                    <span class="dt">VIF =</span> VIF<span class="op">$</span>idiags[,<span class="dv">1</span>]) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-6" title="6"><span class="st">             </span><span class="kw">arrange</span>(<span class="kw">desc</span>(VIF))</a>
<a class="sourceLine" id="cb5-7" title="7"></a>
<a class="sourceLine" id="cb5-8" title="8">knitr<span class="op">::</span><span class="kw">kable</span>(VIF_Table_Before)</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">variable</th>
<th align="right">VIF</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">x_district_name_Hl.m._Praha</td>
<td align="right">Inf</td>
</tr>
<tr class="even">
<td align="left">x_region_Prague</td>
<td align="right">Inf</td>
</tr>
<tr class="odd">
<td align="left">x_no_of_commited_crimes_1996</td>
<td align="right">1737.252782</td>
</tr>
<tr class="even">
<td align="left">x_no_of_inhabitants</td>
<td align="right">675.671761</td>
</tr>
<tr class="odd">
<td align="left">x_prop_other</td>
<td align="right">158.883814</td>
</tr>
<tr class="even">
<td align="left">x_prop_household</td>
<td align="right">121.322251</td>
</tr>
<tr class="odd">
<td align="left">x_prop_interest_credited</td>
<td align="right">63.016856</td>
</tr>
<tr class="even">
<td align="left">x_prop_loan_payment</td>
<td align="right">42.844366</td>
</tr>
<tr class="odd">
<td align="left">x_prop_insurance_payment</td>
<td align="right">33.485319</td>
</tr>
<tr class="even">
<td align="left">x_unemploymant_rate_1996</td>
<td align="right">17.565631</td>
</tr>
<tr class="odd">
<td align="left">x_average_salary</td>
<td align="right">14.792865</td>
</tr>
<tr class="even">
<td align="left">x_unemploymant_rate_1995</td>
<td align="right">13.836322</td>
</tr>
<tr class="odd">
<td align="left">x_transaction_amount</td>
<td align="right">13.273428</td>
</tr>
<tr class="even">
<td align="left">x_prop_statement</td>
<td align="right">12.772024</td>
</tr>
<tr class="odd">
<td align="left">x_transaction_count</td>
<td align="right">12.427778</td>
</tr>
<tr class="even">
<td align="left">x_region_north_Moravia</td>
<td align="right">8.801723</td>
</tr>
<tr class="odd">
<td align="left">x_no_of_municip_2000_to_9999</td>
<td align="right">6.734151</td>
</tr>
<tr class="even">
<td align="left">x_region_south_Moravia</td>
<td align="right">6.373857</td>
</tr>
<tr class="odd">
<td align="left">x_no_of_cities</td>
<td align="right">6.319146</td>
</tr>
<tr class="even">
<td align="left">x_no_of_enterpreneurs_per_1000_inhabitants</td>
<td align="right">6.011420</td>
</tr>
<tr class="odd">
<td align="left">x_ratio_of_urban_inhabitants</td>
<td align="right">5.366908</td>
</tr>
<tr class="even">
<td align="left">x_no_of_municip_500_to_1999</td>
<td align="right">4.801759</td>
</tr>
<tr class="odd">
<td align="left">x_loan_amount</td>
<td align="right">3.673608</td>
</tr>
<tr class="even">
<td align="left">x_region_central_Bohemia</td>
<td align="right">3.666128</td>
</tr>
<tr class="odd">
<td align="left">x_region_north_Bohemia</td>
<td align="right">3.568482</td>
</tr>
<tr class="even">
<td align="left">x_no_of_municip_greater_10000</td>
<td align="right">3.520489</td>
</tr>
<tr class="odd">
<td align="left">x_no_of_commited_crimes_1995</td>
<td align="right">3.515248</td>
</tr>
<tr class="even">
<td align="left">x_loan_payments</td>
<td align="right">3.494173</td>
</tr>
<tr class="odd">
<td align="left">x_no_of_municip_inhabitants_less_499</td>
<td align="right">3.449762</td>
</tr>
<tr class="even">
<td align="left">x_region_east_Bohemia</td>
<td align="right">3.426500</td>
</tr>
<tr class="odd">
<td align="left">x_loan_duration</td>
<td align="right">2.654518</td>
</tr>
<tr class="even">
<td align="left">x_region_south_Bohemia</td>
<td align="right">2.349037</td>
</tr>
<tr class="odd">
<td align="left">x_avg_account_balance</td>
<td align="right">1.826483</td>
</tr>
<tr class="even">
<td align="left">y_loan_defaulter</td>
<td align="right">1.747653</td>
</tr>
<tr class="odd">
<td align="left">x_card_type_classic</td>
<td align="right">1.712001</td>
</tr>
<tr class="even">
<td align="left">x_card_age_month</td>
<td align="right">1.692020</td>
</tr>
<tr class="odd">
<td align="left">x_account_balance</td>
<td align="right">1.444177</td>
</tr>
<tr class="even">
<td align="left">x_client_age</td>
<td align="right">1.108422</td>
</tr>
<tr class="odd">
<td align="left">x_last_transaction_age_days</td>
<td align="right">1.086435</td>
</tr>
<tr class="even">
<td align="left">x_client_gender_male</td>
<td align="right">1.079951</td>
</tr>
</tbody>
</table>
<p>Having identified the predictors with high VIF we look at the correlogram on those variables.</p>
<p>Here we are hiding the variable names for readability.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1">low_VIF &lt;-<span class="st"> </span><span class="kw">filter</span>(VIF_Table_Before, VIF <span class="op">&lt;=</span><span class="st"> </span><span class="dv">5</span>)<span class="op">$</span>variable</a>
<a class="sourceLine" id="cb6-2" title="2">high_VIF &lt;-<span class="st"> </span><span class="kw">filter</span>(VIF_Table_Before, VIF <span class="op">&gt;</span><span class="st"> </span><span class="dv">5</span>)<span class="op">$</span>variable</a>
<a class="sourceLine" id="cb6-3" title="3"></a>
<a class="sourceLine" id="cb6-4" title="4">high_VIF_dataset &lt;-<span class="st"> </span>dplyr<span class="op">::</span><span class="kw">select</span>(loan_dataset_logistic, high_VIF)</a>
<a class="sourceLine" id="cb6-5" title="5"></a>
<a class="sourceLine" id="cb6-6" title="6">cor_mtx_high_VIF &lt;-<span class="st"> </span><span class="kw">cor</span>(high_VIF_dataset)</a>
<a class="sourceLine" id="cb6-7" title="7"></a>
<a class="sourceLine" id="cb6-8" title="8">high_VIF_correlogram_before &lt;-<span class="st"> </span><span class="kw">ggcorrplot</span>(cor_mtx_high_VIF, </a>
<a class="sourceLine" id="cb6-9" title="9">                                <span class="dt">hc.order =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb6-10" title="10">                                <span class="dt">lab =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb6-11" title="11">                                <span class="dt">lab_size =</span> <span class="dv">3</span>, </a>
<a class="sourceLine" id="cb6-12" title="12">                                <span class="dt">method=</span><span class="st">&quot;square&quot;</span>,</a>
<a class="sourceLine" id="cb6-13" title="13">                                <span class="dt">colors =</span> <span class="kw">c</span>(<span class="st">&quot;tomato2&quot;</span>, <span class="st">&quot;white&quot;</span>, <span class="st">&quot;springgreen3&quot;</span>),</a>
<a class="sourceLine" id="cb6-14" title="14">                                <span class="dt">title=</span><span class="st">&quot;Correlation Matrix of Loan Dataset Variables with high VIF&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb6-15" title="15"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb6-16" title="16">        <span class="dt">legend.position =</span> <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb6-17" title="17"></a>
<a class="sourceLine" id="cb6-18" title="18"><span class="kw">print</span>(high_VIF_correlogram_before)</a></code></pre></div>
<p><img src="04_logistic_regression_report_files/figure-html/check_correl_2-1.png" width="100%" /></p>
<p>We will now exclude the variables with High VIF maintaining only the variables that are not correlated.</p>
<p>We will use the pairwise correlation indexes to choose the variable to reject, code below will exclude the variable in the pair that have the greater correlation index sum against the other predictor not in the pair.</p>
<p>At the end we will have only variables that have a correlation index smaller than our selected <strong>threshold (0.6)</strong>.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1">correl_threshold &lt;-<span class="st"> </span><span class="fl">0.6</span></a>
<a class="sourceLine" id="cb7-2" title="2"></a>
<a class="sourceLine" id="cb7-3" title="3">reject_variables_vector &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">var_1 =</span> <span class="kw">row.names</span>(cor_mtx_high_VIF)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-4" title="4"><span class="st">  </span><span class="kw">bind_cols</span>(<span class="kw">as_tibble</span>(cor_mtx_high_VIF)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-5" title="5"><span class="st">  </span><span class="kw">melt</span>(<span class="dt">id =</span> <span class="kw">c</span>(<span class="st">&quot;var_1&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-6" title="6"><span class="st">  </span><span class="kw">filter</span>(var_<span class="dv">1</span> <span class="op">!=</span><span class="st"> </span>variable) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-7" title="7"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">abs_value =</span> <span class="kw">abs</span>(value)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-8" title="8"><span class="st">  </span><span class="kw">filter</span>(abs_value <span class="op">&gt;</span><span class="st"> </span>correl_threshold) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-9" title="9"><span class="st">  </span><span class="kw">group_by</span>(var_<span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-10" title="10"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">sum_1 =</span> <span class="kw">sum</span>(abs_value)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-11" title="11"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-12" title="12"><span class="st">  </span><span class="kw">group_by</span>(variable) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-13" title="13"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">sum_2 =</span> <span class="kw">sum</span>(abs_value)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-14" title="14"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-15" title="15"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">reject =</span> <span class="kw">ifelse</span>(sum_<span class="dv">1</span> <span class="op">&gt;</span><span class="st"> </span>sum_<span class="dv">2</span>, var_<span class="dv">1</span>, <span class="kw">as.character</span>(variable))) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-16" title="16"><span class="st">  </span><span class="kw">distinct</span>(reject)</a>
<a class="sourceLine" id="cb7-17" title="17"></a>
<a class="sourceLine" id="cb7-18" title="18">reject_variables_vector &lt;-<span class="st"> </span>reject_variables_vector<span class="op">$</span>reject</a>
<a class="sourceLine" id="cb7-19" title="19"></a>
<a class="sourceLine" id="cb7-20" title="20">clean_dataset &lt;-<span class="st"> </span>dplyr<span class="op">::</span><span class="kw">select</span>(loan_dataset_logistic, <span class="op">-</span>reject_variables_vector)</a>
<a class="sourceLine" id="cb7-21" title="21"></a>
<a class="sourceLine" id="cb7-22" title="22"><span class="kw">kable</span>(reject_variables_vector)</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">x_district_name_Hl.m._Praha</td>
</tr>
<tr class="even">
<td align="left">x_no_of_commited_crimes_1996</td>
</tr>
<tr class="odd">
<td align="left">x_no_of_inhabitants</td>
</tr>
<tr class="even">
<td align="left">x_no_of_enterpreneurs_per_1000_inhabitants</td>
</tr>
<tr class="odd">
<td align="left">x_region_Prague</td>
</tr>
<tr class="even">
<td align="left">x_prop_other</td>
</tr>
<tr class="odd">
<td align="left">x_prop_household</td>
</tr>
<tr class="even">
<td align="left">x_unemploymant_rate_1995</td>
</tr>
<tr class="odd">
<td align="left">x_transaction_amount</td>
</tr>
<tr class="even">
<td align="left">x_transaction_count</td>
</tr>
<tr class="odd">
<td align="left">x_no_of_cities</td>
</tr>
</tbody>
</table>
<p>After the high VIF predictors exclusion we reevaluate the correlation matrix of the original dataset and the cleaned dataset.</p>
<p>Variable names are hidden for readability. Trust us, there is no correlation greater than 0.6 here.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1">cor_mtx_full &lt;-<span class="st"> </span><span class="kw">cor</span>(loan_dataset_logistic)</a>
<a class="sourceLine" id="cb8-2" title="2">cor_mtx_clean &lt;-<span class="st"> </span><span class="kw">cor</span>(clean_dataset,)</a>
<a class="sourceLine" id="cb8-3" title="3"></a>
<a class="sourceLine" id="cb8-4" title="4">full =<span class="st"> </span><span class="kw">ggcorrplot</span>(cor_mtx_full, <span class="dt">hc.order =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb8-5" title="5">           <span class="dt">lab =</span> <span class="ot">FALSE</span>, </a>
<a class="sourceLine" id="cb8-6" title="6">           <span class="dt">lab_size =</span> <span class="dv">3</span>, </a>
<a class="sourceLine" id="cb8-7" title="7">           <span class="dt">method=</span><span class="st">&quot;square&quot;</span>, </a>
<a class="sourceLine" id="cb8-8" title="8">           <span class="dt">colors =</span> <span class="kw">c</span>(<span class="st">&quot;tomato2&quot;</span>, <span class="st">&quot;white&quot;</span>, <span class="st">&quot;springgreen3&quot;</span>),</a>
<a class="sourceLine" id="cb8-9" title="9">           <span class="dt">title=</span><span class="st">&quot;Correlation Matrix of Full Loan Dataset&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb8-10" title="10"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb8-11" title="11">        <span class="dt">legend.position =</span> <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb8-12" title="12"></a>
<a class="sourceLine" id="cb8-13" title="13">clean =<span class="st"> </span><span class="kw">ggcorrplot</span>(cor_mtx_clean, <span class="dt">hc.order =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb8-14" title="14">           <span class="dt">lab =</span> <span class="ot">FALSE</span>, </a>
<a class="sourceLine" id="cb8-15" title="15">           <span class="dt">lab_size =</span> <span class="dv">3</span>, </a>
<a class="sourceLine" id="cb8-16" title="16">           <span class="dt">method=</span><span class="st">&quot;square&quot;</span>, </a>
<a class="sourceLine" id="cb8-17" title="17">           <span class="dt">colors =</span> <span class="kw">c</span>(<span class="st">&quot;tomato2&quot;</span>, <span class="st">&quot;white&quot;</span>, <span class="st">&quot;springgreen3&quot;</span>),</a>
<a class="sourceLine" id="cb8-18" title="18">           <span class="dt">title=</span><span class="st">&quot;Correlation Matrix of Clean Loan Dataset&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb8-19" title="19"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb8-20" title="20">        <span class="dt">legend.position =</span> <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb8-21" title="21"></a>
<a class="sourceLine" id="cb8-22" title="22"><span class="kw">print</span>(<span class="kw">ggarrange</span>(full, clean))</a></code></pre></div>
<p><img src="04_logistic_regression_report_files/figure-html/check_correl_4-1.png" width="100%" /></p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1">loan_dataset_logistic &lt;-<span class="st"> </span>clean_dataset</a></code></pre></div>
<p>Once again let’s look on the VIF estimates.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1">vars.quant &lt;-<span class="st"> </span><span class="kw">select_if</span>(loan_dataset_logistic, is.numeric)</a>
<a class="sourceLine" id="cb10-2" title="2"></a>
<a class="sourceLine" id="cb10-3" title="3">VIF &lt;-<span class="st"> </span><span class="kw">imcdiag</span>(vars.quant, loan_dataset_logistic<span class="op">$</span>y_loan_defaulter)</a>
<a class="sourceLine" id="cb10-4" title="4"></a>
<a class="sourceLine" id="cb10-5" title="5">VIF_Table_After &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">variable =</span> <span class="kw">names</span>(VIF<span class="op">$</span>idiags[,<span class="dv">1</span>]),</a>
<a class="sourceLine" id="cb10-6" title="6">                          <span class="dt">VIF =</span> VIF<span class="op">$</span>idiags[,<span class="dv">1</span>]) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-7" title="7"><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(VIF))</a>
<a class="sourceLine" id="cb10-8" title="8"></a>
<a class="sourceLine" id="cb10-9" title="9"><span class="kw">ggplot</span>(VIF_Table_After, <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">fct_reorder</span>(variable, VIF), </a>
<a class="sourceLine" id="cb10-10" title="10">                            <span class="dt">y =</span> <span class="kw">log</span>(VIF), <span class="dt">label =</span> <span class="kw">round</span>(VIF, <span class="dv">2</span>))) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-11" title="11"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">stat=</span><span class="st">&#39;identity&#39;</span>, <span class="dt">fill=</span><span class="st">&quot;black&quot;</span>, <span class="dt">size=</span><span class="dv">15</span>)  <span class="op">+</span></a>
<a class="sourceLine" id="cb10-12" title="12"><span class="st">  </span><span class="kw">geom_segment</span>(<span class="kw">aes</span>(<span class="dt">y =</span> <span class="dv">0</span>, </a>
<a class="sourceLine" id="cb10-13" title="13">                   <span class="dt">yend =</span> <span class="kw">log</span>(VIF), </a>
<a class="sourceLine" id="cb10-14" title="14">                   <span class="dt">xend =</span> variable), </a>
<a class="sourceLine" id="cb10-15" title="15">               <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb10-16" title="16"><span class="st">  </span><span class="kw">geom_text</span>(<span class="dt">color=</span><span class="st">&quot;white&quot;</span>, <span class="dt">size=</span><span class="dv">4</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb10-17" title="17"><span class="st">  </span><span class="kw">geom_hline</span>(<span class="kw">aes</span>(<span class="dt">yintercept =</span> <span class="kw">log</span>(<span class="dv">5</span>)), <span class="dt">color =</span> <span class="st">&#39;red&#39;</span>, <span class="dt">size =</span> <span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb10-18" title="18"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> <span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb10-19" title="19"><span class="st">  </span><span class="kw">coord_flip</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb10-20" title="20"><span class="st">  </span><span class="kw">theme_economist</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb10-21" title="21"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&#39;none&#39;</span>, </a>
<a class="sourceLine" id="cb10-22" title="22">        <span class="dt">panel.grid.major =</span> <span class="kw">element_blank</span>(), </a>
<a class="sourceLine" id="cb10-23" title="23">        <span class="dt">panel.grid.minor =</span> <span class="kw">element_blank</span>()) <span class="op">+</span></a>
<a class="sourceLine" id="cb10-24" title="24"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&#39;Variable&#39;</span>,</a>
<a class="sourceLine" id="cb10-25" title="25">       <span class="dt">y =</span> <span class="ot">NULL</span>,</a>
<a class="sourceLine" id="cb10-26" title="26">       <span class="dt">title =</span> <span class="st">&#39;Variance Inflation Factor&#39;</span>,</a>
<a class="sourceLine" id="cb10-27" title="27">       <span class="dt">subtitle=</span><span class="st">&quot;Checking for multicolinearity in X&#39;s variables.</span></a>
<a class="sourceLine" id="cb10-28" title="28"><span class="st">       Variables with VIF more than 5 will be droped from the model&quot;</span>)</a></code></pre></div>
<p><img src="04_logistic_regression_report_files/figure-html/check_correl_5-1.png" width="100%" /></p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1">loan_dataset_logistic &lt;-<span class="st"> </span>dplyr<span class="op">::</span><span class="kw">select</span>(loan_dataset_logistic, <span class="op">-</span>x_average_salary)</a></code></pre></div>
<p>Although <strong>x_average_salary</strong> have no correlation index greater than our defined <strong>threshold (0.6)</strong> it still have a VIF greater than 5, and for pure methodological puritanism we decided to exclude this variable as well.</p>
<p>We did try to keep it, but it had no real difference.</p>
<p><img src="04_logistic_regression_report_files/figure-html/check_correl_6-1.png" width="100%" /></p>
<p>After all this work we end up having <strong>28 variables</strong> in the dataset.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1"><span class="kw">kable</span>(<span class="kw">tibble</span>(<span class="dt">variables =</span> <span class="kw">names</span>(loan_dataset_logistic)))</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">variables</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">y_loan_defaulter</td>
</tr>
<tr class="even">
<td align="left">x_account_balance</td>
</tr>
<tr class="odd">
<td align="left">x_avg_account_balance</td>
</tr>
<tr class="even">
<td align="left">x_card_age_month</td>
</tr>
<tr class="odd">
<td align="left">x_card_type_classic</td>
</tr>
<tr class="even">
<td align="left">x_client_age</td>
</tr>
<tr class="odd">
<td align="left">x_client_gender_male</td>
</tr>
<tr class="even">
<td align="left">x_last_transaction_age_days</td>
</tr>
<tr class="odd">
<td align="left">x_loan_amount</td>
</tr>
<tr class="even">
<td align="left">x_loan_duration</td>
</tr>
<tr class="odd">
<td align="left">x_loan_payments</td>
</tr>
<tr class="even">
<td align="left">x_no_of_commited_crimes_1995</td>
</tr>
<tr class="odd">
<td align="left">x_no_of_municip_2000_to_9999</td>
</tr>
<tr class="even">
<td align="left">x_no_of_municip_500_to_1999</td>
</tr>
<tr class="odd">
<td align="left">x_no_of_municip_greater_10000</td>
</tr>
<tr class="even">
<td align="left">x_no_of_municip_inhabitants_less_499</td>
</tr>
<tr class="odd">
<td align="left">x_prop_insurance_payment</td>
</tr>
<tr class="even">
<td align="left">x_prop_interest_credited</td>
</tr>
<tr class="odd">
<td align="left">x_prop_loan_payment</td>
</tr>
<tr class="even">
<td align="left">x_prop_statement</td>
</tr>
<tr class="odd">
<td align="left">x_ratio_of_urban_inhabitants</td>
</tr>
<tr class="even">
<td align="left">x_region_central_Bohemia</td>
</tr>
<tr class="odd">
<td align="left">x_region_east_Bohemia</td>
</tr>
<tr class="even">
<td align="left">x_region_north_Bohemia</td>
</tr>
<tr class="odd">
<td align="left">x_region_north_Moravia</td>
</tr>
<tr class="even">
<td align="left">x_region_south_Bohemia</td>
</tr>
<tr class="odd">
<td align="left">x_region_south_Moravia</td>
</tr>
<tr class="even">
<td align="left">x_unemploymant_rate_1996</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="looking-for-outliers" class="section level2">
<h2><span class="header-section-number">2.3</span> Looking for outliers</h2>
<p>And what about outliers?</p>
<p>Regression algorithms are known for its sensitivity for outliers. So, before we go for the modeling juice, we will look for those bastards!!!</p>
<p>Looking at the plots we see no significant deviation in the quantitative variables.</p>
<p><strong>x_last_transaction_age_days</strong> looks to have a discrepancy, but it is ranging from 0 to 30 days, so it is not real outliers.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1"><span class="co"># outliers ----------------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb13-2" title="2">  <span class="kw">attach</span>(loan_dataset_logistic)</a>
<a class="sourceLine" id="cb13-3" title="3"></a>
<a class="sourceLine" id="cb13-4" title="4">  <span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">3</span>))</a>
<a class="sourceLine" id="cb13-5" title="5"></a>
<a class="sourceLine" id="cb13-6" title="6">  <span class="kw">plot</span>(x_last_transaction_age_days, <span class="dt">main =</span> <span class="st">&quot;x_last_transaction_age_days&quot;</span>, <span class="dt">ylab =</span> <span class="st">&#39;&#39;</span>)</a>
<a class="sourceLine" id="cb13-7" title="7">  <span class="kw">plot</span>(x_avg_account_balance, <span class="dt">main =</span> <span class="st">&quot;x_avg_account_balance&quot;</span>, <span class="dt">ylab =</span> <span class="st">&#39;&#39;</span>)</a>
<a class="sourceLine" id="cb13-8" title="8">  <span class="kw">plot</span>(x_account_balance, <span class="dt">main =</span> <span class="st">&quot;x_account_balance&quot;</span>, <span class="dt">ylab =</span> <span class="st">&#39;&#39;</span>)</a>
<a class="sourceLine" id="cb13-9" title="9">  <span class="kw">plot</span>(x_card_age_month, <span class="dt">main =</span> <span class="st">&quot;x_card_age_month&quot;</span>, <span class="dt">ylab =</span> <span class="st">&#39;&#39;</span>)</a>
<a class="sourceLine" id="cb13-10" title="10">  <span class="kw">plot</span>(x_client_age, <span class="dt">main =</span> <span class="st">&quot;x_client_age&quot;</span>, <span class="dt">ylab =</span> <span class="st">&#39;&#39;</span>)</a>
<a class="sourceLine" id="cb13-11" title="11">  <span class="kw">plot</span>(x_loan_amount, <span class="dt">main =</span> <span class="st">&quot;x_loan_amount&quot;</span>, <span class="dt">ylab =</span> <span class="st">&#39;&#39;</span>)</a></code></pre></div>
<p><img src="04_logistic_regression_report_files/figure-html/outliers-1.png" width="100%" /></p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" title="1">  <span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">3</span>))</a>
<a class="sourceLine" id="cb14-2" title="2">  </a>
<a class="sourceLine" id="cb14-3" title="3">  <span class="kw">plot</span>(x_loan_duration, <span class="dt">main =</span> <span class="st">&quot;x_loan_duration&quot;</span>, <span class="dt">ylab =</span> <span class="st">&#39;&#39;</span>)</a>
<a class="sourceLine" id="cb14-4" title="4">  <span class="kw">plot</span>(x_loan_payments, <span class="dt">main =</span> <span class="st">&quot;x_loan_payments&quot;</span>, <span class="dt">ylab =</span> <span class="st">&#39;&#39;</span>)</a>
<a class="sourceLine" id="cb14-5" title="5">  <span class="kw">plot</span>(x_prop_interest_credited, <span class="dt">main =</span> <span class="st">&quot;x_prop_interest_credited&quot;</span>, <span class="dt">ylab =</span> <span class="st">&#39;&#39;</span>)</a>
<a class="sourceLine" id="cb14-6" title="6">  <span class="kw">plot</span>(x_prop_loan_payment, <span class="dt">main =</span> <span class="st">&quot;x_prop_loan_payment&quot;</span>, <span class="dt">ylab =</span> <span class="st">&#39;&#39;</span>)</a>
<a class="sourceLine" id="cb14-7" title="7">  <span class="kw">plot</span>(x_prop_statement, <span class="dt">main =</span> <span class="st">&quot;x_prop_statement&quot;</span>, <span class="dt">ylab =</span> <span class="st">&#39;&#39;</span>)</a>
<a class="sourceLine" id="cb14-8" title="8">  <span class="kw">plot</span>(x_prop_insurance_payment, <span class="dt">main =</span> <span class="st">&quot;x_prop_insurance_payment&quot;</span>, <span class="dt">ylab =</span> <span class="st">&#39;&#39;</span>)</a></code></pre></div>
<p><img src="04_logistic_regression_report_files/figure-html/outliers-2.png" width="100%" /></p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" title="1">  <span class="kw">detach</span>(loan_dataset_logistic)</a></code></pre></div>
</div>
<div id="sample-split-into-test-and-training-data" class="section level2">
<h2><span class="header-section-number">2.4</span> Sample split into Test and Training Data</h2>
<p>The available data in Loan Dataset is split into Train and Testing data on the following proportion:</p>
<ul>
<li><strong>Train Dataset</strong> (70% 478 obs);</li>
<li><strong>Test Dataset </strong> (30% 204 obs).</li>
</ul>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" title="1">SplitDataset &lt;-<span class="st"> </span>source_train_test_dataset</a>
<a class="sourceLine" id="cb16-2" title="2">data.train_logistic &lt;-<span class="st"> </span>SplitDataset<span class="op">$</span>data.train</a>
<a class="sourceLine" id="cb16-3" title="3">data.test_logistic &lt;-<span class="st"> </span>SplitDataset<span class="op">$</span>data.test</a>
<a class="sourceLine" id="cb16-4" title="4"></a>
<a class="sourceLine" id="cb16-5" title="5">data.train_logistic &lt;-<span class="st"> </span>dplyr<span class="op">::</span><span class="kw">select</span>(data.train_logistic, <span class="kw">names</span>(loan_dataset_logistic))</a>
<a class="sourceLine" id="cb16-6" title="6">data.test_logistic &lt;-<span class="st"> </span>dplyr<span class="op">::</span><span class="kw">select</span>(data.test_logistic, <span class="kw">names</span>(loan_dataset_logistic))</a>
<a class="sourceLine" id="cb16-7" title="7"></a>
<a class="sourceLine" id="cb16-8" title="8"><span class="kw">kable</span>(SplitDataset<span class="op">$</span>event.proportion)</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">scope</th>
<th align="right">0</th>
<th align="right">1</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">full dataset</td>
<td align="right">0.8885630</td>
<td align="right">0.1114370</td>
</tr>
<tr class="even">
<td align="left">train dataset</td>
<td align="right">0.8933054</td>
<td align="right">0.1066946</td>
</tr>
<tr class="odd">
<td align="left">test dataset</td>
<td align="right">0.8774510</td>
<td align="right">0.1225490</td>
</tr>
</tbody>
</table>
<p>Both datasets keep the same proportion for the explained variable around 11%.</p>
<p>This split was saved in disk using the function described in the Data Prep session to be reused in the other models fitted in this exercise.</p>
<p>This will ensure consistency when comparing the models against each other.</p>
</div>
<div id="fit-the-logistic-model" class="section level2">
<h2><span class="header-section-number">2.5</span> Fit the logistic model</h2>
<p>With the final cleaned dataset, we got from above steps we fit our Logistic Regression model for <strong>y_loan_defaulter</strong> on all <strong>x_variables</strong>.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" title="1">logistic.full &lt;-<span class="st"> </span><span class="kw">glm</span>(<span class="dt">formula =</span> y_loan_defaulter <span class="op">~</span><span class="st"> </span>.,</a>
<a class="sourceLine" id="cb17-2" title="2">                     <span class="dt">data=</span> data.train_logistic, </a>
<a class="sourceLine" id="cb17-3" title="3">                     <span class="dt">family=</span> <span class="kw">binomial</span>(<span class="dt">link=</span><span class="st">&#39;logit&#39;</span>))</a>
<a class="sourceLine" id="cb17-4" title="4"></a>
<a class="sourceLine" id="cb17-5" title="5"><span class="kw">names</span>(logistic.full<span class="op">$</span>coefficients) &lt;-<span class="st"> </span>stringr<span class="op">::</span><span class="kw">str_sub</span>(<span class="kw">names</span>(logistic.full<span class="op">$</span>coefficients), <span class="dv">1</span>, <span class="dv">25</span>)</a>
<a class="sourceLine" id="cb17-6" title="6"><span class="kw">summary</span>(logistic.full)</a></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = y_loan_defaulter ~ ., family = binomial(link = &quot;logit&quot;), 
##     data = data.train_logistic)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -1.7010  -0.4459  -0.2581  -0.1265   2.8663  
## 
## Coefficients:
##                             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)               -5.084e+00  1.641e+00  -3.098  0.00195 ** 
## x_account_balance          2.002e-06  1.381e-06   1.449  0.14731    
## x_avg_account_balance     -4.817e-06  3.099e-06  -1.554  0.12011    
## x_card_age_month           1.942e-02  2.814e-02   0.690  0.49012    
## x_card_type_classic       -1.204e+00  8.006e-01  -1.504  0.13254    
## x_client_age               2.090e-02  1.429e-02   1.462  0.14370    
## x_client_gender_male       1.372e-01  3.698e-01   0.371  0.71058    
## x_last_transaction_age_da  3.964e-02  4.271e-02   0.928  0.35334    
## x_loan_amount              6.652e-06  2.977e-06   2.234  0.02546 *  
## x_loan_duration           -1.922e-02  1.923e-02  -1.000  0.31747    
## x_loan_payments            2.884e-03  1.901e-03   1.517  0.12932    
## x_no_of_commited_crimes_1 -1.315e-02  9.606e-03  -1.369  0.17103    
## x_no_of_municip_2000_to_9 -1.573e-02  6.817e-02  -0.231  0.81749    
## x_no_of_municip_500_to_19 -1.444e-03  2.251e-02  -0.064  0.94885    
## x_no_of_municip_greater_1 -3.568e-01  2.523e-01  -1.414  0.15724    
## x_no_of_municip_inhabitan  1.761e-04  7.632e-03   0.023  0.98160    
## x_prop_insurance_payment   1.436e+00  3.356e+00   0.428  0.66874    
## x_prop_interest_credited   1.148e+01  2.339e+00   4.910 9.09e-07 ***
## x_prop_loan_payment       -3.390e+00  3.469e+00  -0.977  0.32846    
## x_prop_statement           9.522e+00  4.815e+00   1.977  0.04800 *  
## x_ratio_of_urban_inhabita  1.581e-02  1.265e-02   1.250  0.21136    
## x_region_central_Bohemia   3.158e-01  6.845e-01   0.461  0.64451    
## x_region_east_Bohemia     -1.617e-01  7.855e-01  -0.206  0.83685    
## x_region_north_Bohemia    -1.567e+01  9.478e+02  -0.017  0.98681    
## x_region_north_Moravia     2.998e-01  8.667e-01   0.346  0.72941    
## x_region_south_Bohemia    -1.200e-02  7.639e-01  -0.016  0.98747    
## x_region_south_Moravia     2.674e-01  6.841e-01   0.391  0.69586    
## x_unemploymant_rate_1996   7.339e-03  1.325e-02   0.554  0.57954    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 324.61  on 477  degrees of freedom
## Residual deviance: 237.44  on 450  degrees of freedom
## AIC: 293.44
## 
## Number of Fisher Scoring iterations: 17</code></pre>
<p>With the full model fitted we will run the stepwise method to automate the selection of predictors using the <strong>(Akaike Information Criterion)</strong> AIC for short.</p>
<p>This is a broadly used estimator that evaluates the relative quality of statistical methods for a given set of data.</p>
<p>The lower the AIC the better.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" title="1">logistic.step &lt;-<span class="st"> </span><span class="kw">step</span>(logistic.full, <span class="dt">direction =</span> <span class="st">&quot;both&quot;</span>, <span class="dt">test =</span> <span class="st">&quot;F&quot;</span>)</a>
<a class="sourceLine" id="cb19-2" title="2"></a>
<a class="sourceLine" id="cb19-3" title="3"><span class="kw">names</span>(logistic.step<span class="op">$</span>coefficients) &lt;-<span class="st"> </span>stringr<span class="op">::</span><span class="kw">str_sub</span>(<span class="kw">names</span>(logistic.step<span class="op">$</span>coefficients), <span class="dv">1</span>, <span class="dv">25</span>)</a></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = y_loan_defaulter ~ x_card_type_classic + x_loan_amount + 
##     x_loan_duration + x_no_of_commited_crimes_1995 + x_prop_interest_credited + 
##     x_prop_statement + x_region_north_Bohemia, family = binomial(link = &quot;logit&quot;), 
##     data = data.train_logistic)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -1.3847  -0.4555  -0.2810  -0.1517   2.6217  
## 
## Coefficients:
##                             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)               -3.579e+00  6.289e-01  -5.691 1.26e-08 ***
## x_card_type_classic       -9.526e-01  6.307e-01  -1.510  0.13094    
## x_loan_amount              9.176e-06  1.914e-06   4.794 1.64e-06 ***
## x_loan_duration           -3.878e-02  1.467e-02  -2.643  0.00821 ** 
## x_no_of_commited_crimes_1 -1.650e-02  7.139e-03  -2.311  0.02083 *  
## x_prop_interest_credited   1.072e+01  1.895e+00   5.659 1.52e-08 ***
## x_prop_statement           9.416e+00  4.269e+00   2.206  0.02741 *  
## x_region_north_Bohemia    -1.547e+01  9.701e+02  -0.016  0.98728    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 324.61  on 477  degrees of freedom
## Residual deviance: 249.63  on 470  degrees of freedom
## AIC: 265.63
## 
## Number of Fisher Scoring iterations: 17</code></pre>
<hr />
</div>
</div>
<div id="interpreting-model-output" class="section level1">
<h1><span class="header-section-number">3</span> Interpreting model output</h1>
<p>Logistic Regression models are not only good for prediction but also for inference.</p>
<p>Meaning that it can be used not only in predicting the classification into Defaulters and Non-Defaulters but also to understand the relationship between the predictors and the likelihood of delinquency.</p>
<p>In the Logistic Regression the effect of an increase or decrease of a predictor is not linear, but we can see the predictors that have the greater influence and by its coefficient signal the associated with an increase or decrease on the likelihood of default.</p>
<p>The probability of default is given by below equation:</p>
<p><span class="math display">\[P(Y = 1 | X_{n} = x_{n}) = \frac{1}{1 + e^{(-\beta_{0}+\beta_{1}x_{1}+\beta_{2}x_{2}+...+\beta_{n}x_{n} )}}\]</span></p>
<p>Where each β is the coefficient estimate for each variable in the final model.</p>
<p>In our model we see that below variables are associated to an increase in the likelihood of default:</p>
<ul>
<li><strong>x_loan_amount</strong></li>
<li><strong>x_prop_interest_credited</strong></li>
<li><strong>x_prop_statement</strong></li>
</ul>
<p>On the other hand, below variables are associated to a decrease in the likelihood of default:</p>
<ul>
<li><strong>x_card_type_classic</strong></li>
<li><strong>x_loan_duration</strong></li>
<li><strong>x_no_of_commited_crimes_1995</strong></li>
<li><strong>x_loan_amount</strong></li>
<li><strong>x_region_north_Bohemia</strong></li>
</ul>
<hr />
</div>
<div id="evaluating-the-model-performance" class="section level1">
<h1><span class="header-section-number">4</span> Evaluating the model performance</h1>
<p>We started this step by making predictions using our model on the X’s variables in our Train and Test datasets.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" title="1"><span class="co">## making predictions for each model and consolidating in a single data frame</span></a>
<a class="sourceLine" id="cb21-2" title="2"></a>
<a class="sourceLine" id="cb21-3" title="3">prob.full   =<span class="st"> </span><span class="kw">list</span>()</a>
<a class="sourceLine" id="cb21-4" title="4">prob.train  =<span class="st"> </span><span class="kw">list</span>()</a>
<a class="sourceLine" id="cb21-5" title="5">prob.test   =<span class="st"> </span><span class="kw">list</span>()</a>
<a class="sourceLine" id="cb21-6" title="6"></a>
<a class="sourceLine" id="cb21-7" title="7">prob.full<span class="op">$</span>logistic.actual     &lt;-<span class="st"> </span>loan_dataset_logistic<span class="op">$</span>y_loan_defaulter</a>
<a class="sourceLine" id="cb21-8" title="8">prob.full<span class="op">$</span>logistic.predicted  &lt;-<span class="st"> </span><span class="kw">predict</span>(logistic.step, <span class="dt">type =</span> <span class="st">&quot;response&quot;</span>, </a>
<a class="sourceLine" id="cb21-9" title="9">                                         <span class="dt">newdata =</span> loan_dataset_logistic)</a>
<a class="sourceLine" id="cb21-10" title="10"></a>
<a class="sourceLine" id="cb21-11" title="11">prob.train<span class="op">$</span>logistic.actual    &lt;-<span class="st"> </span>data.train_logistic<span class="op">$</span>y_loan_defaulter</a>
<a class="sourceLine" id="cb21-12" title="12">prob.train<span class="op">$</span>logistic.predicted &lt;-<span class="st"> </span><span class="kw">predict</span>(logistic.step, <span class="dt">type =</span> <span class="st">&quot;response&quot;</span>, </a>
<a class="sourceLine" id="cb21-13" title="13">                                         <span class="dt">newdata =</span> data.train_logistic)</a>
<a class="sourceLine" id="cb21-14" title="14"></a>
<a class="sourceLine" id="cb21-15" title="15">prob.test<span class="op">$</span>logistic.actual     &lt;-<span class="st"> </span>data.test_logistic<span class="op">$</span>y_loan_defaulter</a>
<a class="sourceLine" id="cb21-16" title="16">prob.test<span class="op">$</span>logistic.predicted  &lt;-<span class="st"> </span><span class="kw">predict</span>(logistic.step, <span class="dt">type =</span> <span class="st">&quot;response&quot;</span>, </a>
<a class="sourceLine" id="cb21-17" title="17">                                         <span class="dt">newdata =</span> data.test_logistic)</a>
<a class="sourceLine" id="cb21-18" title="18"></a>
<a class="sourceLine" id="cb21-19" title="19">prob.full   &lt;-<span class="st"> </span>prob.full  <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as_tibble</span>()</a>
<a class="sourceLine" id="cb21-20" title="20">prob.train  &lt;-<span class="st"> </span>prob.train <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as_tibble</span>()</a>
<a class="sourceLine" id="cb21-21" title="21">prob.test   &lt;-<span class="st"> </span>prob.test  <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as_tibble</span>()</a></code></pre></div>
<div id="getting-performance-measures" class="section level2">
<h2><span class="header-section-number">4.1</span> Getting Performance Measures</h2>
<p>To calculate the performance measures, derived from the confusion matrix, we need to find the score cut off that best split our test dataset into Defaulters and Non-Defaulters.</p>
<p>In this exercise we decide to not prioritize the accuracy on predicting Defaulters and Non-Defaulters, therefore we are looking for the score cut off that best predict each class equally.</p>
<p>We will use the custom functions described in Auxiliary metrics functions topic in the Data Preparation session of this site.</p>
<p>With the returned object from this function we can plot the comparison between TPR (True Positive Rate) and TNR (True Negative Rate) to find the best cut off.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" title="1"><span class="co">## getting measures -----------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb22-2" title="2"></a>
<a class="sourceLine" id="cb22-3" title="3">metricsByCutoff.test_log    &lt;-<span class="st"> </span><span class="kw">modelMetrics</span>(prob.test<span class="op">$</span>logistic.actual, </a>
<a class="sourceLine" id="cb22-4" title="4">                                            prob.test<span class="op">$</span>logistic.predicted, </a>
<a class="sourceLine" id="cb22-5" title="5">                                            <span class="dt">plot_title =</span> <span class="st">&#39;Logistic Regression&#39;</span>)</a>
<a class="sourceLine" id="cb22-6" title="6">metricsByCutoff.test_log<span class="op">$</span>Plot</a></code></pre></div>
<div id="htmlwidget-d03619ccb5fb5c256f6e" style="width:100%;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-d03619ccb5fb5c256f6e">{"x":{"visdat":{"3cc0600a7258":["function () ","plotlyVisDat"]},"cur_data":"3cc0600a7258","attrs":{"3cc0600a7258":{"x":{},"y":{},"opacity":0.3,"name":"Abs. Diff.","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"bar"},"3cc0600a7258.1":{"x":{},"y":{},"opacity":1,"name":"TPR","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","inherit":true},"3cc0600a7258.2":{"x":{},"y":{},"opacity":1,"name":"TNR","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"lines","inherit":true},"3cc0600a7258.3":{"x":0.08,"y":0.64,"opacity":1,"name":"Abs. Diff.","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","text":0.08,"mode":"text","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"xaxis":{"domain":[0,1],"automargin":true,"title":"Cutoff Value"},"yaxis":{"domain":[0,1],"automargin":true,"title":"True Ratio (%)"},"title":"Logistic Regression","hovermode":"closest","showlegend":true},"source":"A","config":{"showSendToCloud":false},"data":[{"x":[0.01,0.02,0.03,0.04,0.05,0.06,0.07,0.08,0.09,0.1,0.11,0.12,0.13,0.14,0.15,0.16,0.17,0.18,0.19,0.2,0.21,0.22,0.23,0.24,0.25,0.26,0.27,0.28,0.29,0.3,0.31,0.32,0.33,0.34,0.35,0.36,0.37,0.38,0.39,0.4,0.41,0.42,0.43,0.44,0.45,0.46,0.47,0.48,0.49,0.5,0.51,0.52,0.53,0.54,0.55,0.56,0.57,0.58,0.59,0.6,0.61,0.62,0.63,0.64,0.65,0.66,0.67,0.68,0.69,0.7,0.71,0.72,0.73,0.74,0.75,0.76,0.77],"y":[0.820335195530726,0.686256983240223,0.516871508379888,0.415418994413408,0.26927374301676,0.167821229050279,0.0319553072625699,0.0303910614525139,0.0918435754189943,0.130949720670391,0.147709497206704,0.215642458100559,0.277988826815642,0.311508379888268,0.357094972067039,0.36268156424581,0.413854748603352,0.419441340782123,0.465027932960894,0.521787709497207,0.527374301675978,0.567374301675978,0.57854748603352,0.61854748603352,0.629720670391061,0.635307262569832,0.640893854748603,0.640893854748603,0.640893854748603,0.646480446927374,0.646480446927374,0.646480446927374,0.692067039106145,0.772067039106145,0.772067039106145,0.772067039106145,0.772067039106145,0.772067039106145,0.772067039106145,0.783240223463687,0.823240223463687,0.863240223463687,0.903240223463687,0.903240223463687,0.903240223463687,0.903240223463687,0.908826815642458,0.908826815642458,0.908826815642458,0.908826815642458,0.914413407821229,0.914413407821229,0.954413407821229,0.954413407821229,0.954413407821229,0.954413407821229,0.954413407821229,0.954413407821229,0.954413407821229,0.954413407821229,0.954413407821229,0.954413407821229,0.954413407821229,0.954413407821229,0.954413407821229,0.954413407821229,0.954413407821229,0.954413407821229,0.954413407821229,0.954413407821229,0.954413407821229,0.954413407821229,0.954413407821229,0.954413407821229,0.954413407821229,0.954413407821229,0.96],"opacity":0.3,"name":"Abs. Diff.","type":"bar","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[0.01,0.02,0.03,0.04,0.05,0.06,0.07,0.08,0.09,0.1,0.11,0.12,0.13,0.14,0.15,0.16,0.17,0.18,0.19,0.2,0.21,0.22,0.23,0.24,0.25,0.26,0.27,0.28,0.29,0.3,0.31,0.32,0.33,0.34,0.35,0.36,0.37,0.38,0.39,0.4,0.41,0.42,0.43,0.44,0.45,0.46,0.47,0.48,0.49,0.5,0.51,0.52,0.53,0.54,0.55,0.56,0.57,0.58,0.59,0.6,0.61,0.62,0.63,0.64,0.65,0.66,0.67,0.68,0.69,0.7,0.71,0.72,0.73,0.74,0.75,0.76,0.77],"y":[0.96,0.96,0.88,0.84,0.8,0.76,0.68,0.64,0.64,0.64,0.64,0.6,0.56,0.56,0.52,0.52,0.48,0.48,0.44,0.4,0.4,0.36,0.36,0.32,0.32,0.32,0.32,0.32,0.32,0.32,0.32,0.32,0.28,0.2,0.2,0.2,0.2,0.2,0.2,0.2,0.16,0.12,0.08,0.08,0.08,0.08,0.08,0.08,0.08,0.08,0.08,0.08,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04],"opacity":1,"name":"TPR","type":"scatter","mode":"lines","marker":{"color":"rgba(255,127,14,1)","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"line":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[0.01,0.02,0.03,0.04,0.05,0.06,0.07,0.08,0.09,0.1,0.11,0.12,0.13,0.14,0.15,0.16,0.17,0.18,0.19,0.2,0.21,0.22,0.23,0.24,0.25,0.26,0.27,0.28,0.29,0.3,0.31,0.32,0.33,0.34,0.35,0.36,0.37,0.38,0.39,0.4,0.41,0.42,0.43,0.44,0.45,0.46,0.47,0.48,0.49,0.5,0.51,0.52,0.53,0.54,0.55,0.56,0.57,0.58,0.59,0.6,0.61,0.62,0.63,0.64,0.65,0.66,0.67,0.68,0.69,0.7,0.71,0.72,0.73,0.74,0.75,0.76,0.77],"y":[0.139664804469274,0.273743016759777,0.363128491620112,0.424581005586592,0.53072625698324,0.592178770949721,0.64804469273743,0.670391061452514,0.731843575418994,0.770949720670391,0.787709497206704,0.815642458100559,0.837988826815642,0.871508379888268,0.877094972067039,0.88268156424581,0.893854748603352,0.899441340782123,0.905027932960894,0.921787709497207,0.927374301675978,0.927374301675978,0.93854748603352,0.93854748603352,0.949720670391061,0.955307262569832,0.960893854748603,0.960893854748603,0.960893854748603,0.966480446927374,0.966480446927374,0.966480446927374,0.972067039106145,0.972067039106145,0.972067039106145,0.972067039106145,0.972067039106145,0.972067039106145,0.972067039106145,0.983240223463687,0.983240223463687,0.983240223463687,0.983240223463687,0.983240223463687,0.983240223463687,0.983240223463687,0.988826815642458,0.988826815642458,0.988826815642458,0.988826815642458,0.994413407821229,0.994413407821229,0.994413407821229,0.994413407821229,0.994413407821229,0.994413407821229,0.994413407821229,0.994413407821229,0.994413407821229,0.994413407821229,0.994413407821229,0.994413407821229,0.994413407821229,0.994413407821229,0.994413407821229,0.994413407821229,0.994413407821229,0.994413407821229,0.994413407821229,0.994413407821229,0.994413407821229,0.994413407821229,0.994413407821229,0.994413407821229,0.994413407821229,0.994413407821229,1],"opacity":1,"name":"TNR","type":"scatter","mode":"lines","marker":{"color":"rgba(44,160,44,1)","line":{"color":"rgba(44,160,44,1)"}},"error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"line":{"color":"rgba(44,160,44,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[0.08],"y":[0.64],"opacity":1,"name":"Abs. Diff.","type":"scatter","text":0.08,"mode":"text","marker":{"color":"rgba(214,39,40,1)","line":{"color":"rgba(214,39,40,1)"}},"error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"line":{"color":"rgba(214,39,40,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
<p>With the optimized cut off we calculate the full set of model metrics using the function HMeasure from hmeasure library.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" title="1"><span class="co"># logistic regression</span></a>
<a class="sourceLine" id="cb23-2" title="2">measures.logistic.train &lt;-<span class="st"> </span><span class="kw">HMeasure</span>(prob.train<span class="op">$</span>logistic.actual, </a>
<a class="sourceLine" id="cb23-3" title="3">                                    prob.train<span class="op">$</span>logistic.predicted, </a>
<a class="sourceLine" id="cb23-4" title="4">                                    <span class="dt">threshold =</span> metricsByCutoff.test_log<span class="op">$</span>BestCut[<span class="st">&#39;Cut&#39;</span>])</a>
<a class="sourceLine" id="cb23-5" title="5">measures.logistic.test &lt;-<span class="st"> </span><span class="kw">HMeasure</span>(prob.test<span class="op">$</span>logistic.actual, </a>
<a class="sourceLine" id="cb23-6" title="6">                                   prob.test<span class="op">$</span>logistic.predicted, </a>
<a class="sourceLine" id="cb23-7" title="7">                                   <span class="dt">threshold =</span> metricsByCutoff.test_log<span class="op">$</span>BestCut[<span class="st">&#39;Cut&#39;</span>])</a>
<a class="sourceLine" id="cb23-8" title="8"></a>
<a class="sourceLine" id="cb23-9" title="9"><span class="co"># join measures in a single data frame</span></a>
<a class="sourceLine" id="cb23-10" title="10">measures &lt;-<span class="st"> </span><span class="kw">t</span>(<span class="kw">bind_rows</span>(measures.logistic.train<span class="op">$</span>metrics,</a>
<a class="sourceLine" id="cb23-11" title="11">                        measures.logistic.test<span class="op">$</span>metrics)</a>
<a class="sourceLine" id="cb23-12" title="12">              ) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as_tibble</span>(., <span class="dt">rownames =</span> <span class="ot">NA</span>)</a>
<a class="sourceLine" id="cb23-13" title="13"></a>
<a class="sourceLine" id="cb23-14" title="14"><span class="kw">colnames</span>(measures) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;logistic - train&#39;</span>, <span class="st">&#39;logistic - test&#39;</span>)</a>
<a class="sourceLine" id="cb23-15" title="15"></a>
<a class="sourceLine" id="cb23-16" title="16">measures<span class="op">$</span>metric =<span class="st"> </span><span class="kw">rownames</span>(measures)</a>
<a class="sourceLine" id="cb23-17" title="17"></a>
<a class="sourceLine" id="cb23-18" title="18">measures &lt;-<span class="st"> </span>dplyr<span class="op">::</span><span class="kw">select</span>(measures, metric, <span class="kw">everything</span>())</a></code></pre></div>
<p>Below are the metrics on the train and test dataset:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" title="1"><span class="kw">kable</span>(measures, <span class="dt">row.names =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">metric</th>
<th align="right">logistic - train</th>
<th align="right">logistic - test</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">H</td>
<td align="right">0.3612900</td>
<td align="right">0.3070793</td>
</tr>
<tr class="even">
<td align="left">Gini</td>
<td align="right">0.6641411</td>
<td align="right">0.5195531</td>
</tr>
<tr class="odd">
<td align="left">AUC</td>
<td align="right">0.8320705</td>
<td align="right">0.7597765</td>
</tr>
<tr class="even">
<td align="left">AUCH</td>
<td align="right">0.8475456</td>
<td align="right">0.7915084</td>
</tr>
<tr class="odd">
<td align="left">KS</td>
<td align="right">0.5492033</td>
<td align="right">0.4370950</td>
</tr>
<tr class="even">
<td align="left">MER</td>
<td align="right">0.0920502</td>
<td align="right">0.1078431</td>
</tr>
<tr class="odd">
<td align="left">MWL</td>
<td align="right">0.0859316</td>
<td align="right">0.1210592</td>
</tr>
<tr class="even">
<td align="left">Spec.Sens95</td>
<td align="right">0.5339578</td>
<td align="right">0.3072626</td>
</tr>
<tr class="odd">
<td align="left">Sens.Spec95</td>
<td align="right">0.3725490</td>
<td align="right">0.3200000</td>
</tr>
<tr class="even">
<td align="left">ER</td>
<td align="right">0.3347280</td>
<td align="right">0.3333333</td>
</tr>
<tr class="odd">
<td align="left">Sens</td>
<td align="right">0.8431373</td>
<td align="right">0.6400000</td>
</tr>
<tr class="even">
<td align="left">Spec</td>
<td align="right">0.6440281</td>
<td align="right">0.6703911</td>
</tr>
<tr class="odd">
<td align="left">Precision</td>
<td align="right">0.2205128</td>
<td align="right">0.2133333</td>
</tr>
<tr class="even">
<td align="left">Recall</td>
<td align="right">0.8431373</td>
<td align="right">0.6400000</td>
</tr>
<tr class="odd">
<td align="left">TPR</td>
<td align="right">0.8431373</td>
<td align="right">0.6400000</td>
</tr>
<tr class="even">
<td align="left">FPR</td>
<td align="right">0.3559719</td>
<td align="right">0.3296089</td>
</tr>
<tr class="odd">
<td align="left">F</td>
<td align="right">0.3495935</td>
<td align="right">0.3200000</td>
</tr>
<tr class="even">
<td align="left">Youden</td>
<td align="right">0.4871654</td>
<td align="right">0.3103911</td>
</tr>
<tr class="odd">
<td align="left">TP</td>
<td align="right">43.0000000</td>
<td align="right">16.0000000</td>
</tr>
<tr class="even">
<td align="left">FP</td>
<td align="right">152.0000000</td>
<td align="right">59.0000000</td>
</tr>
<tr class="odd">
<td align="left">TN</td>
<td align="right">275.0000000</td>
<td align="right">120.0000000</td>
</tr>
<tr class="even">
<td align="left">FN</td>
<td align="right">8.0000000</td>
<td align="right">9.0000000</td>
</tr>
</tbody>
</table>
</div>
<div id="evaluating-classification-performance" class="section level2">
<h2><span class="header-section-number">4.2</span> Evaluating classification performance</h2>
<p>In general the Logistic Regression model is not delivering good accuracy, we will compare how it performed against other classes of models in the Final Report session</p>
<p>Below the confusion matrix and general performance of the model using our custom function <strong>accuracy</strong> described in Auxiliary metrics functions topic in the Data Preparation session of this site.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" title="1"><span class="co"># accuracy metrics ---------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb25-2" title="2"><span class="co"># logistic regression</span></a>
<a class="sourceLine" id="cb25-3" title="3"><span class="kw">accuracy</span>(<span class="dt">score =</span> prob.test<span class="op">$</span>logistic.predicted, </a>
<a class="sourceLine" id="cb25-4" title="4">         <span class="dt">actual =</span> prob.test<span class="op">$</span>logistic.actual, </a>
<a class="sourceLine" id="cb25-5" title="5">         <span class="dt">threshold =</span> metricsByCutoff.test_log[[<span class="st">&quot;BestCut&quot;</span>]][[<span class="st">&quot;Cut&quot;</span>]])</a></code></pre></div>
<pre><code>## 
## 
##             pred.1   pred.0
## ---------  -------  -------
## actual.1        16        9
## actual.0        59      120
## [1] &quot;--------------------------------------------------------------&quot;
## [1] &quot;Model General Accuracy of: 66.67%&quot;
## [1] &quot;True Positive Rate of    : 64%&quot;</code></pre>
<p>We finally look at the score distribution charts to check how well the model is able to discriminate Defaulters and Non-Defaulters.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" title="1">p1 &lt;-<span class="st"> </span><span class="kw">Score_Histograms</span>(prob.test, </a>
<a class="sourceLine" id="cb27-2" title="2">                 prob.test<span class="op">$</span>logistic.predicted,</a>
<a class="sourceLine" id="cb27-3" title="3">                 prob.test<span class="op">$</span>logistic.actual,</a>
<a class="sourceLine" id="cb27-4" title="4">                 <span class="st">&#39;Density Plot&#39;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">axis.title.y =</span> <span class="kw">element_blank</span>())</a>
<a class="sourceLine" id="cb27-5" title="5"></a>
<a class="sourceLine" id="cb27-6" title="6">p2 &lt;-<span class="st"> </span><span class="kw">Score_Boxplot</span>(prob.test, </a>
<a class="sourceLine" id="cb27-7" title="7">              prob.test<span class="op">$</span>logistic.predicted, </a>
<a class="sourceLine" id="cb27-8" title="8">              prob.test<span class="op">$</span>logistic.actual,</a>
<a class="sourceLine" id="cb27-9" title="9">              <span class="st">&#39;Score Boxplot&#39;</span>)</a>
<a class="sourceLine" id="cb27-10" title="10"></a>
<a class="sourceLine" id="cb27-11" title="11">p3 &lt;-<span class="st"> </span><span class="kw">KS_Plot</span>(prob.test<span class="op">$</span>logistic.predicted[prob.test<span class="op">$</span>logistic.actual <span class="op">==</span><span class="st"> </span><span class="dv">0</span>],</a>
<a class="sourceLine" id="cb27-12" title="12">        prob.test<span class="op">$</span>logistic.predicted[prob.test<span class="op">$</span>logistic.actual <span class="op">==</span><span class="st"> </span><span class="dv">1</span>],</a>
<a class="sourceLine" id="cb27-13" title="13">        <span class="st">&#39;KS Plot&#39;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">axis.title.y =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb27-14" title="14">                           <span class="dt">axis.text.y =</span> <span class="kw">element_blank</span>())</a>
<a class="sourceLine" id="cb27-15" title="15"><span class="kw">ggarrange</span>(p1, p2, <span class="dt">nrow =</span> <span class="dv">2</span>)</a></code></pre></div>
<p><img src="04_logistic_regression_report_files/figure-html/model_plots-1.png" width="100%" /></p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" title="1">p3</a></code></pre></div>
<p><img src="04_logistic_regression_report_files/figure-html/model_plots-2.png" width="100%" /></p>
<p>By the score density we see that our Logistic Regression model is very broad on the scores it assigns to the observations, especially for the real Defaulters not providing a good separation between each class.</p>
<p>The box plot also does not show a clear discrimination between Defaulters and Non-Defaulters.</p>
<p>Finally, the KS metric is far from what is expected for a reasonable classification model.</p>
<p>In the Final Report session, we will look more closely on the AUC and Gini metrics by plotting the ROC curve and comparing against other models.</p>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
